<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.1.1"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="lowkeysp">
<meta property="og:type" content="website">
<meta property="og:title" content="lowkeysp&#39; Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="lowkeysp&#39; Blog">
<meta property="og:description" content="lowkeysp">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lowkeysp">
<meta property="article:tag" content="IT">
<meta name="twitter:card" content="summary">





  
  
  <link rel="canonical" href="http://yoursite.com/page/3/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>lowkeysp' Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<meta name="generator" content="Hexo 6.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lowkeysp' Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Stay Hungry, Stay Foolish!</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section">&lt;i class&#x3D;&quot;menu-item-icon fa fa-fw fa-home&quot;&gt;&lt;&#x2F;i&gt; &lt;br&#x2F;&gt;首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section">&lt;i class&#x3D;&quot;menu-item-icon fa fa-fw fa-tags&quot;&gt;&lt;&#x2F;i&gt; &lt;br&#x2F;&gt;标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section">&lt;i class&#x3D;&quot;menu-item-icon fa fa-fw fa-th&quot;&gt;&lt;&#x2F;i&gt; &lt;br&#x2F;&gt;分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section">&lt;i class&#x3D;&quot;menu-item-icon fa fa-fw fa-archive&quot;&gt;&lt;&#x2F;i&gt; &lt;br&#x2F;&gt;归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/14/NameNode%E5%92%8CSecondaryNameNode%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/07/14/NameNode%E5%92%8CSecondaryNameNode%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">NameNode，SecondaryNameNode，DataNode工作机制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-07-14 14:27:52" itemprop="dateCreated datePublished" datetime="2021-07-14T14:27:52+08:00">2021-07-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/07/14/NameNode%E5%92%8CSecondaryNameNode%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6/" class="leancloud_visitors" data-flag-title="NameNode，SecondaryNameNode，DataNode工作机制">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<h1 id="NameNode，SecondaryNameNode工作机制"><a href="#NameNode，SecondaryNameNode工作机制" class="headerlink" title="NameNode，SecondaryNameNode工作机制"></a>NameNode，SecondaryNameNode工作机制</h1><p>NameNode的数据文件如下，目录为<code>/opt/module/hadoop-3.3.1/data/dfs/name/current</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1/data/dfs/name/current$ ll</span><br><span class="line">总用量 4180</span><br><span class="line">drwx------ 2 lowkeysp-00 lowkeysp-00    4096 7月   4 23:18 ./</span><br><span class="line">drwxrwxr-x 3 lowkeysp-00 lowkeysp-00    4096 7月   4 23:37 ../</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      42 7月   3 23:07 edits_0000000000000000001-0000000000000000002</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00    7056 7月   4 00:07 edits_0000000000000000003-0000000000000000066</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 1048576 7月   4 00:20 edits_0000000000000000067-0000000000000000117</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 1048576 7月   4 20:12 edits_0000000000000000118-0000000000000000169</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00   23867 7月   4 21:26 edits_0000000000000000170-0000000000000000340</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      42 7月   4 22:26 edits_0000000000000000341-0000000000000000342</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 1048576 7月   4 22:53 edits_0000000000000000343-0000000000000000440</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      42 7月   4 23:18 edits_0000000000000000441-0000000000000000442</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 1048576 7月   4 23:18 edits_inprogress_0000000000000000443</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00    4771 7月   4 22:26 fsimage_0000000000000000342</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      62 7月   4 22:26 fsimage_0000000000000000342.md5</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00    5702 7月   4 23:18 fsimage_0000000000000000442</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      62 7月   4 23:18 fsimage_0000000000000000442.md5</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00       4 7月   4 23:18 seen_txid</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00     212 7月   4 19:48 VERSION</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SecondaryNameNode的数据文件如下,目录为:<code>/opt/module/hadoop-3.3.1/data/dfs/namesecondary/current</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-04:/opt/module/hadoop-3.3.1/data/dfs/namesecondary/current$ ll</span><br><span class="line">总用量 2128</span><br><span class="line">drwxrwxr-x 2 lowkeysp-00 lowkeysp-00    4096 7月   4 23:18 ./</span><br><span class="line">drwxrwxr-x 3 lowkeysp-00 lowkeysp-00    4096 7月   4 23:37 ../</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      42 7月   3 23:07 edits_0000000000000000001-0000000000000000002</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00    7056 7月   4 00:07 edits_0000000000000000003-0000000000000000066</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 1048576 7月   4 21:26 edits_0000000000000000118-0000000000000000169</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00   23867 7月   4 21:26 edits_0000000000000000170-0000000000000000340</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      42 7月   4 22:26 edits_0000000000000000341-0000000000000000342</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 1048576 7月   4 23:18 edits_0000000000000000343-0000000000000000440</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      42 7月   4 23:18 edits_0000000000000000441-0000000000000000442</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00    4771 7月   4 23:18 fsimage_0000000000000000342</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      62 7月   4 23:18 fsimage_0000000000000000342.md5</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00    5702 7月   4 23:18 fsimage_0000000000000000442</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00      62 7月   4 23:18 fsimage_0000000000000000442.md5</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00     212 7月   4 23:18 VERSION</span><br></pre></td></tr></table></figure>

<p>可以看到，NameNode有如下文件：<code>edits_</code>,<code>edits_inprogress_</code>,<code>fsimage_</code>,SecondaryNameNode有如下文件：<code>edits_</code>,<code>fsimage_</code></p>
<p>NameNode的元数据存储在内存中，为了防止断电导致内存中的数据丢失，在磁盘中备份了元数据，叫做<code>fsimage</code>。当内存中的元数据更新时，如果同时更新fsimage，会导致效率低下，如果不更新，则会发生不一致问题。为解决这一问题，引入了<code>Edits</code>文件。该文件只进行追加操作，效率很高。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到Edits文件中，这样，即使断电，仍可通过Fsimage和Edits合并，合成元数据</p>
<p>具体工作机制如下：</p>
<ul>
<li><p>1）第一次启动NameNode格式化后，会创建<code>Fsimage</code>文件和<code>seen_txid</code>文件，其中Fsimage是HDFS系统的元数据的一个永久性的检查点，记录着整个文件目录结构以及文件每个数据块所在的节点位置，seen_txid文件记录了正在执行的事务id，初始化时为0。</p>
</li>
<li><p>2）当进行文件操作后，NameNode会生成<code>edits_</code>和<code>edits_inprogress_</code>文件，该文件存放了HDFS文件系统的所有更新操作。HDFS每个操作都会产生一个事务id，<code>edits_0000000000000000001-0000000000000000002</code>表示这里面记录了两个事务操作，<code>edits_inprogress_0000000000000000443</code>表示这个文件正在被编辑，且下一个事务id应该从443开始，此时seen_txid的内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1/data/dfs/name/current$ cat seen_txid </span><br><span class="line">443</span><br></pre></td></tr></table></figure></li>
<li><p>3)当每次NameNode启动时，内存会加载Fsimage和edits文件，保证内存中的元数据是最新的。比如将fsimage_0000000000000000442和edits_inprogress_0000000000000000443进行合并（edits_inprogress_0000000000000000443需先变成edits_00000XX，fsimage_0000000000000000442表示已经合并到442了，不会再跟1-442的edits进行合并了），然后跟发当对HDFS文件系统进行操作时，NameNode并不会直接更新fsimage，而是把该次操作先记录到edits文件中，然后再更新内存中的元数据。</p>
</li>
<li><p>4）SecondaryNameNode会去协助NameNode合并Fsimage和edits，而不用等到每次NameNode启动时再合并，CheckPoint的触发条件有两个：<br>1、SecondaryNameNode会定期询问NameNode是否需要合并，默认定时时间是1小时；2、NameNode中的edits数据满了，默认是100万条操作</p>
</li>
<li><p>5）如果NameNode同意合并，则NameNode滚动正在写的edits日志，即将edits_inprogress_文件变成edits_000000XX文件，比如，edits_inprogress_0000000000000000443变成edits_0000000000000000443，之后再生成edits_inprogress_0000000000000000444用于接受合并过程中对HDFS文件系统的操作。</p>
</li>
<li><p>6）将edits_文件和fsimage文件拷贝到SecondaryNameNode，SecondaryNameNode加载到内存中进行合并，生成fsimage.chkpoint。再将fsimage.chkpoint送回NameNode，NameNode将fsimage.chkpoint重新命名为fsimage</p>
</li>
</ul>
<p>一小时合并一次文件，hdfs-default.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;3600s&lt;/value&gt;</span><br><span class="line">&lt;/property</span><br></pre></td></tr></table></figure>

<p>操作100万次就认为满了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;property&gt; </span><br><span class="line">    &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;1000000&lt;/value&gt;</span><br><span class="line">    &lt;description&gt;操作动作次数&lt;/description&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/property&gt;</span><br><span class="line"> </span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;60s&lt;/value&gt;</span><br><span class="line">    &lt;description&gt; 1分钟检查一次操作次数&lt;/description&gt;</span><br><span class="line"> &lt;/property&gt;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="查看Fsimage"><a href="#查看Fsimage" class="headerlink" title="查看Fsimage"></a>查看Fsimage</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">hdfs oiv : apply the offline fsimage viewer to an fsimage</span><br><span class="line"></span><br><span class="line">基本语法：</span><br><span class="line">hdfs oiv -p 转换后的文件类型 -i 镜像文件 -o 转换后文件输出路径</span><br><span class="line"></span><br><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1/data/dfs/name/current$ hdfs oiv -p xml -i fsimage_0000000000000000342 -o ~/fsimage.xml</span><br><span class="line">2021-07-14 15:44:26,738 INFO offlineImageViewer.FSImageHandler: Loading 5 strings</span><br><span class="line">2021-07-14 15:44:26,800 INFO namenode.FSDirectory: GLOBAL serial map: bits=29 maxEntries=536870911</span><br><span class="line">2021-07-14 15:44:26,800 INFO namenode.FSDirectory: USER serial map: bits=24 maxEntries=16777215</span><br><span class="line">2021-07-14 15:44:26,800 INFO namenode.FSDirectory: GROUP serial map: bits=24 maxEntries=16777215</span><br><span class="line">2021-07-14 15:44:26,800 INFO namenode.FSDirectory: XATTR serial map: bits=24 maxEntries=16777215</span><br><span class="line"></span><br><span class="line">查看fsimage.xml，里面存储了文件目录的信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lowkeysp-00@lowkeysp-01:~$ cat fsimage.xml </span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;fsimage&gt;&lt;version&gt;&lt;layoutVersion&gt;-66&lt;/layoutVersion&gt;&lt;onDiskVersion&gt;1&lt;/onDiskVersion&gt;&lt;oivRevision&gt;a3b9c37a397ad4188041dd80621bdeefc46885f2&lt;/oivRevision&gt;&lt;/version&gt;</span><br><span class="line">&lt;NameSection&gt;&lt;namespaceId&gt;159680868&lt;/namespaceId&gt;&lt;genstampV1&gt;1000&lt;/genstampV1&gt;&lt;genstampV2&gt;1045&lt;/genstampV2&gt;&lt;genstampV1Limit&gt;0&lt;/genstampV1Limit&gt;&lt;lastAllocatedBlockId&gt;1073741869&lt;/lastAllocatedBlockId&gt;&lt;txid&gt;342&lt;/txid&gt;&lt;/NameSection&gt;</span><br><span class="line">&lt;ErasureCodingSection&gt;</span><br><span class="line">&lt;erasureCodingPolicy&gt;</span><br><span class="line">&lt;policyId&gt;1&lt;/policyId&gt;&lt;policyName&gt;RS-6-3-1024k&lt;/policyName&gt;&lt;cellSize&gt;1048576&lt;/cellSize&gt;&lt;policyState&gt;DISABLED&lt;/policyState&gt;&lt;ecSchema&gt;</span><br><span class="line">&lt;codecName&gt;rs&lt;/codecName&gt;&lt;dataUnits&gt;6&lt;/dataUnits&gt;&lt;parityUnits&gt;3&lt;/parityUnits&gt;&lt;/ecSchema&gt;</span><br><span class="line">&lt;/erasureCodingPolicy&gt;</span><br><span class="line"></span><br><span class="line">&lt;erasureCodingPolicy&gt;</span><br><span class="line">&lt;policyId&gt;2&lt;/policyId&gt;&lt;policyName&gt;RS-3-2-1024k&lt;/policyName&gt;&lt;cellSize&gt;1048576&lt;/cellSize&gt;&lt;policyState&gt;DISABLED&lt;/policyState&gt;&lt;ecSchema&gt;</span><br><span class="line">&lt;codecName&gt;rs&lt;/codecName&gt;&lt;dataUnits&gt;3&lt;/dataUnits&gt;&lt;parityUnits&gt;2&lt;/parityUnits&gt;&lt;/ecSchema&gt;</span><br><span class="line">&lt;/erasureCodingPolicy&gt;</span><br><span class="line"></span><br><span class="line">&lt;erasureCodingPolicy&gt;</span><br><span class="line">&lt;policyId&gt;3&lt;/policyId&gt;&lt;policyName&gt;RS-LEGACY-6-3-1024k&lt;/policyName&gt;&lt;cellSize&gt;1048576&lt;/cellSize&gt;&lt;policyState&gt;DISABLED&lt;/policyState&gt;&lt;ecSchema&gt;</span><br><span class="line">&lt;codecName&gt;rs-legacy&lt;/codecName&gt;&lt;dataUnits&gt;6&lt;/dataUnits&gt;&lt;parityUnits&gt;3&lt;/parityUnits&gt;&lt;/ecSchema&gt;</span><br><span class="line">&lt;/erasureCodingPolicy&gt;</span><br><span class="line"></span><br><span class="line">&lt;erasureCodingPolicy&gt;</span><br><span class="line">&lt;policyId&gt;4&lt;/policyId&gt;&lt;policyName&gt;XOR-2-1-1024k&lt;/policyName&gt;&lt;cellSize&gt;1048576&lt;/cellSize&gt;&lt;policyState&gt;DISABLED&lt;/policyState&gt;&lt;ecSchema&gt;</span><br><span class="line">&lt;codecName&gt;xor&lt;/codecName&gt;&lt;dataUnits&gt;2&lt;/dataUnits&gt;&lt;parityUnits&gt;1&lt;/parityUnits&gt;&lt;/ecSchema&gt;</span><br><span class="line">&lt;/erasureCodingPolicy&gt;</span><br><span class="line"></span><br><span class="line">&lt;erasureCodingPolicy&gt;</span><br><span class="line">&lt;policyId&gt;5&lt;/policyId&gt;&lt;policyName&gt;RS-10-4-1024k&lt;/policyName&gt;&lt;cellSize&gt;1048576&lt;/cellSize&gt;&lt;policyState&gt;DISABLED&lt;/policyState&gt;&lt;ecSchema&gt;</span><br><span class="line">&lt;codecName&gt;rs&lt;/codecName&gt;&lt;dataUnits&gt;10&lt;/dataUnits&gt;&lt;parityUnits&gt;4&lt;/parityUnits&gt;&lt;/ecSchema&gt;</span><br><span class="line">&lt;/erasureCodingPolicy&gt;</span><br><span class="line"></span><br><span class="line">&lt;/ErasureCodingSection&gt;</span><br><span class="line"></span><br><span class="line">&lt;INodeSection&gt;&lt;lastInodeId&gt;16468&lt;/lastInodeId&gt;&lt;numInodes&gt;56&lt;/numInodes&gt;&lt;inode&gt;&lt;id&gt;16385&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;&lt;/name&gt;&lt;mtime&gt;1625403554362&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0755&lt;/permission&gt;&lt;nsquota&gt;9223372036854775807&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16386&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;wcinput&lt;/name&gt;&lt;mtime&gt;1625326637268&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0755&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16387&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;aa.txt&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625326637243&lt;/mtime&gt;&lt;atime&gt;1625403562205&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741825&lt;/id&gt;&lt;genstamp&gt;1001&lt;/genstamp&gt;&lt;numBytes&gt;16&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16388&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;tmp&lt;/name&gt;&lt;mtime&gt;1625327231227&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16389&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;hadoop-yarn&lt;/name&gt;&lt;mtime&gt;1625327231227&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16390&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;staging&lt;/name&gt;&lt;mtime&gt;1625401809698&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16391&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;lowkeysp-00&lt;/name&gt;&lt;mtime&gt;1625327231227&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16392&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;.staging&lt;/name&gt;&lt;mtime&gt;1625403573223&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16393&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;job_1625325609725_0001&lt;/name&gt;&lt;mtime&gt;1625327231876&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;xattrs&gt;&lt;xattr&gt;&lt;ns&gt;SYSTEM&lt;/ns&gt;&lt;name&gt;hdfs.erasurecoding.policy&lt;/name&gt;&lt;val&gt;\0000;\0000;\0000;\000b;replication&lt;/val&gt;&lt;/xattr&gt;&lt;/xattrs&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16394&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.jar&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625327231734&lt;/mtime&gt;&lt;atime&gt;1625327231531&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741826&lt;/id&gt;&lt;genstamp&gt;1002&lt;/genstamp&gt;&lt;numBytes&gt;280989&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16395&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.split&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625327231847&lt;/mtime&gt;&lt;atime&gt;1625327231805&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741827&lt;/id&gt;&lt;genstamp&gt;1003&lt;/genstamp&gt;&lt;numBytes&gt;111&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16396&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.splitmetainfo&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625327231865&lt;/mtime&gt;&lt;atime&gt;1625327231849&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741828&lt;/id&gt;&lt;genstamp&gt;1004&lt;/genstamp&gt;&lt;numBytes&gt;25&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16397&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625327232112&lt;/mtime&gt;&lt;atime&gt;1625327231876&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741829&lt;/id&gt;&lt;genstamp&gt;1005&lt;/genstamp&gt;&lt;numBytes&gt;232955&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16398&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;job_1625325609725_0002&lt;/name&gt;&lt;mtime&gt;1625327630899&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;xattrs&gt;&lt;xattr&gt;&lt;ns&gt;SYSTEM&lt;/ns&gt;&lt;name&gt;hdfs.erasurecoding.policy&lt;/name&gt;&lt;val&gt;\0000;\0000;\0000;\000b;replication&lt;/val&gt;&lt;/xattr&gt;&lt;/xattrs&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16399&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.jar&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625327630390&lt;/mtime&gt;&lt;atime&gt;1625327630268&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741830&lt;/id&gt;&lt;genstamp&gt;1006&lt;/genstamp&gt;&lt;numBytes&gt;280989&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16400&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.split&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625327630466&lt;/mtime&gt;&lt;atime&gt;1625327630440&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741831&lt;/id&gt;&lt;genstamp&gt;1007&lt;/genstamp&gt;&lt;numBytes&gt;111&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16401&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.splitmetainfo&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625327630891&lt;/mtime&gt;&lt;atime&gt;1625327630469&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741832&lt;/id&gt;&lt;genstamp&gt;1008&lt;/genstamp&gt;&lt;numBytes&gt;25&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16402&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625327631080&lt;/mtime&gt;&lt;atime&gt;1625327630899&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741833&lt;/id&gt;&lt;genstamp&gt;1009&lt;/genstamp&gt;&lt;numBytes&gt;232955&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16403&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;job_1625325609725_0003&lt;/name&gt;&lt;mtime&gt;1625328819000&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;xattrs&gt;&lt;xattr&gt;&lt;ns&gt;SYSTEM&lt;/ns&gt;&lt;name&gt;hdfs.erasurecoding.policy&lt;/name&gt;&lt;val&gt;\0000;\0000;\0000;\000b;replication&lt;/val&gt;&lt;/xattr&gt;&lt;/xattrs&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16404&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.jar&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625328818879&lt;/mtime&gt;&lt;atime&gt;1625328818762&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741834&lt;/id&gt;&lt;genstamp&gt;1010&lt;/genstamp&gt;&lt;numBytes&gt;280989&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16405&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.split&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625328818971&lt;/mtime&gt;&lt;atime&gt;1625328818940&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741835&lt;/id&gt;&lt;genstamp&gt;1011&lt;/genstamp&gt;&lt;numBytes&gt;111&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16406&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.splitmetainfo&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625328818994&lt;/mtime&gt;&lt;atime&gt;1625328818973&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741836&lt;/id&gt;&lt;genstamp&gt;1012&lt;/genstamp&gt;&lt;numBytes&gt;25&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16407&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625328819158&lt;/mtime&gt;&lt;atime&gt;1625328819000&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741837&lt;/id&gt;&lt;genstamp&gt;1013&lt;/genstamp&gt;&lt;numBytes&gt;232955&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16408&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;job_1625325609725_0004&lt;/name&gt;&lt;mtime&gt;1625329238333&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;xattrs&gt;&lt;xattr&gt;&lt;ns&gt;SYSTEM&lt;/ns&gt;&lt;name&gt;hdfs.erasurecoding.policy&lt;/name&gt;&lt;val&gt;\0000;\0000;\0000;\000b;replication&lt;/val&gt;&lt;/xattr&gt;&lt;/xattrs&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16409&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.jar&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625329238191&lt;/mtime&gt;&lt;atime&gt;1625329238067&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741838&lt;/id&gt;&lt;genstamp&gt;1014&lt;/genstamp&gt;&lt;numBytes&gt;280989&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16410&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.split&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625329238292&lt;/mtime&gt;&lt;atime&gt;1625329238260&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741839&lt;/id&gt;&lt;genstamp&gt;1015&lt;/genstamp&gt;&lt;numBytes&gt;111&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16411&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.splitmetainfo&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625329238322&lt;/mtime&gt;&lt;atime&gt;1625329238295&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741840&lt;/id&gt;&lt;genstamp&gt;1016&lt;/genstamp&gt;&lt;numBytes&gt;25&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16412&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625329238551&lt;/mtime&gt;&lt;atime&gt;1625329238333&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741841&lt;/id&gt;&lt;genstamp&gt;1017&lt;/genstamp&gt;&lt;numBytes&gt;232946&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16413&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;job_1625399359435_0001&lt;/name&gt;&lt;mtime&gt;1625399632503&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;xattrs&gt;&lt;xattr&gt;&lt;ns&gt;SYSTEM&lt;/ns&gt;&lt;name&gt;hdfs.erasurecoding.policy&lt;/name&gt;&lt;val&gt;\0000;\0000;\0000;\000b;replication&lt;/val&gt;&lt;/xattr&gt;&lt;/xattrs&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16414&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.jar&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625399632357&lt;/mtime&gt;&lt;atime&gt;1625399631694&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741842&lt;/id&gt;&lt;genstamp&gt;1018&lt;/genstamp&gt;&lt;numBytes&gt;280989&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16415&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.split&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625399632464&lt;/mtime&gt;&lt;atime&gt;1625399632433&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741843&lt;/id&gt;&lt;genstamp&gt;1019&lt;/genstamp&gt;&lt;numBytes&gt;111&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16416&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.splitmetainfo&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625399632492&lt;/mtime&gt;&lt;atime&gt;1625399632467&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741844&lt;/id&gt;&lt;genstamp&gt;1020&lt;/genstamp&gt;&lt;numBytes&gt;25&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16417&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625399632781&lt;/mtime&gt;&lt;atime&gt;1625399632503&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741845&lt;/id&gt;&lt;genstamp&gt;1021&lt;/genstamp&gt;&lt;numBytes&gt;232946&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16418&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;job_1625399359435_0002&lt;/name&gt;&lt;mtime&gt;1625400724265&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0700&lt;/permission&gt;&lt;xattrs&gt;&lt;xattr&gt;&lt;ns&gt;SYSTEM&lt;/ns&gt;&lt;name&gt;hdfs.erasurecoding.policy&lt;/name&gt;&lt;val&gt;\0000;\0000;\0000;\000b;replication&lt;/val&gt;&lt;/xattr&gt;&lt;/xattrs&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16419&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.jar&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625400724160&lt;/mtime&gt;&lt;atime&gt;1625400724058&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741846&lt;/id&gt;&lt;genstamp&gt;1022&lt;/genstamp&gt;&lt;numBytes&gt;280989&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16420&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.split&lt;/name&gt;&lt;replication&gt;10&lt;/replication&gt;&lt;mtime&gt;1625400724235&lt;/mtime&gt;&lt;atime&gt;1625400724209&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741847&lt;/id&gt;&lt;genstamp&gt;1023&lt;/genstamp&gt;&lt;numBytes&gt;111&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16421&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.splitmetainfo&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625400724259&lt;/mtime&gt;&lt;atime&gt;1625400724237&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741848&lt;/id&gt;&lt;genstamp&gt;1024&lt;/genstamp&gt;&lt;numBytes&gt;25&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16422&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625400724414&lt;/mtime&gt;&lt;atime&gt;1625400724265&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741849&lt;/id&gt;&lt;genstamp&gt;1025&lt;/genstamp&gt;&lt;numBytes&gt;232949&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16428&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;history&lt;/name&gt;&lt;mtime&gt;1625403447744&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0755&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16429&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;done_intermediate&lt;/name&gt;&lt;mtime&gt;1625401809712&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:1777&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16430&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;lowkeysp-00&lt;/name&gt;&lt;mtime&gt;1625403581266&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16431&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;wcoutput&lt;/name&gt;&lt;mtime&gt;1625401824315&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0755&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16438&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;part-r-00000&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625401824131&lt;/mtime&gt;&lt;atime&gt;1625401823963&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741856&lt;/id&gt;&lt;genstamp&gt;1032&lt;/genstamp&gt;&lt;numBytes&gt;17&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16440&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;_SUCCESS&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625401824318&lt;/mtime&gt;&lt;atime&gt;1625401824315&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16443&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job_1625401657661_0001-1625401805929-lowkeysp%2D00-word+count-1625401824326-1-1-SUCCEEDED-default-1625401812270.jhist&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625401824458&lt;/mtime&gt;&lt;atime&gt;1625401824421&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741858&lt;/id&gt;&lt;genstamp&gt;1034&lt;/genstamp&gt;&lt;numBytes&gt;22779&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16444&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job_1625401657661_0001_conf.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625401824534&lt;/mtime&gt;&lt;atime&gt;1625401824472&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741859&lt;/id&gt;&lt;genstamp&gt;1035&lt;/genstamp&gt;&lt;numBytes&gt;269287&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16445&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;done&lt;/name&gt;&lt;mtime&gt;1625403581238&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16452&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;output&lt;/name&gt;&lt;mtime&gt;1625403571872&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0755&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16458&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;part-r-00000&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625403571673&lt;/mtime&gt;&lt;atime&gt;1625403571442&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741866&lt;/id&gt;&lt;genstamp&gt;1042&lt;/genstamp&gt;&lt;numBytes&gt;17&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16460&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;_SUCCESS&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625403571876&lt;/mtime&gt;&lt;atime&gt;1625403571872&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0644&lt;/permission&gt;&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16463&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job_1625403367618_0001-1625403546921-lowkeysp%2D00-word+count-1625403571935-1-1-SUCCEEDED-default-1625403554384.jhist&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625403572069&lt;/mtime&gt;&lt;atime&gt;1625403572023&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741868&lt;/id&gt;&lt;genstamp&gt;1044&lt;/genstamp&gt;&lt;numBytes&gt;22782&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16464&lt;/id&gt;&lt;type&gt;FILE&lt;/type&gt;&lt;name&gt;job_1625403367618_0001_conf.xml&lt;/name&gt;&lt;replication&gt;3&lt;/replication&gt;&lt;mtime&gt;1625403572142&lt;/mtime&gt;&lt;atime&gt;1625403572091&lt;/atime&gt;&lt;preferredBlockSize&gt;134217728&lt;/preferredBlockSize&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;blocks&gt;&lt;block&gt;&lt;id&gt;1073741869&lt;/id&gt;&lt;genstamp&gt;1045&lt;/genstamp&gt;&lt;numBytes&gt;269289&lt;/numBytes&gt;&lt;/block&gt;</span><br><span class="line">&lt;/blocks&gt;</span><br><span class="line">&lt;storagePolicyId&gt;0&lt;/storagePolicyId&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16465&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;2021&lt;/name&gt;&lt;mtime&gt;1625403581238&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16466&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;07&lt;/name&gt;&lt;mtime&gt;1625403581238&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16467&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;04&lt;/name&gt;&lt;mtime&gt;1625403581238&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;inode&gt;&lt;id&gt;16468&lt;/id&gt;&lt;type&gt;DIRECTORY&lt;/type&gt;&lt;name&gt;000000&lt;/name&gt;&lt;mtime&gt;1625403581266&lt;/mtime&gt;&lt;permission&gt;lowkeysp-00:supergroup:0770&lt;/permission&gt;&lt;nsquota&gt;-1&lt;/nsquota&gt;&lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt;</span><br><span class="line">&lt;/INodeSection&gt;</span><br><span class="line">&lt;INodeReferenceSection&gt;&lt;/INodeReferenceSection&gt;&lt;SnapshotSection&gt;&lt;snapshotCounter&gt;0&lt;/snapshotCounter&gt;&lt;numSnapshots&gt;0&lt;/numSnapshots&gt;&lt;/SnapshotSection&gt;</span><br><span class="line">&lt;INodeDirectorySection&gt;&lt;directory&gt;&lt;parent&gt;16385&lt;/parent&gt;&lt;child&gt;16452&lt;/child&gt;&lt;child&gt;16388&lt;/child&gt;&lt;child&gt;16386&lt;/child&gt;&lt;child&gt;16431&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16386&lt;/parent&gt;&lt;child&gt;16387&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16388&lt;/parent&gt;&lt;child&gt;16389&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16389&lt;/parent&gt;&lt;child&gt;16390&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16390&lt;/parent&gt;&lt;child&gt;16428&lt;/child&gt;&lt;child&gt;16391&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16391&lt;/parent&gt;&lt;child&gt;16392&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16392&lt;/parent&gt;&lt;child&gt;16393&lt;/child&gt;&lt;child&gt;16398&lt;/child&gt;&lt;child&gt;16403&lt;/child&gt;&lt;child&gt;16408&lt;/child&gt;&lt;child&gt;16413&lt;/child&gt;&lt;child&gt;16418&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16393&lt;/parent&gt;&lt;child&gt;16394&lt;/child&gt;&lt;child&gt;16395&lt;/child&gt;&lt;child&gt;16396&lt;/child&gt;&lt;child&gt;16397&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16398&lt;/parent&gt;&lt;child&gt;16399&lt;/child&gt;&lt;child&gt;16400&lt;/child&gt;&lt;child&gt;16401&lt;/child&gt;&lt;child&gt;16402&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16403&lt;/parent&gt;&lt;child&gt;16404&lt;/child&gt;&lt;child&gt;16405&lt;/child&gt;&lt;child&gt;16406&lt;/child&gt;&lt;child&gt;16407&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16408&lt;/parent&gt;&lt;child&gt;16409&lt;/child&gt;&lt;child&gt;16410&lt;/child&gt;&lt;child&gt;16411&lt;/child&gt;&lt;child&gt;16412&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16413&lt;/parent&gt;&lt;child&gt;16414&lt;/child&gt;&lt;child&gt;16415&lt;/child&gt;&lt;child&gt;16416&lt;/child&gt;&lt;child&gt;16417&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16418&lt;/parent&gt;&lt;child&gt;16419&lt;/child&gt;&lt;child&gt;16420&lt;/child&gt;&lt;child&gt;16421&lt;/child&gt;&lt;child&gt;16422&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16428&lt;/parent&gt;&lt;child&gt;16445&lt;/child&gt;&lt;child&gt;16429&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16429&lt;/parent&gt;&lt;child&gt;16430&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16431&lt;/parent&gt;&lt;child&gt;16440&lt;/child&gt;&lt;child&gt;16438&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16445&lt;/parent&gt;&lt;child&gt;16465&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16452&lt;/parent&gt;&lt;child&gt;16460&lt;/child&gt;&lt;child&gt;16458&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16465&lt;/parent&gt;&lt;child&gt;16466&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16466&lt;/parent&gt;&lt;child&gt;16467&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16467&lt;/parent&gt;&lt;child&gt;16468&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;directory&gt;&lt;parent&gt;16468&lt;/parent&gt;&lt;child&gt;16443&lt;/child&gt;&lt;child&gt;16444&lt;/child&gt;&lt;child&gt;16463&lt;/child&gt;&lt;child&gt;16464&lt;/child&gt;&lt;/directory&gt;</span><br><span class="line">&lt;/INodeDirectorySection&gt;</span><br><span class="line">&lt;FileUnderConstructionSection&gt;&lt;/FileUnderConstructionSection&gt;</span><br><span class="line">&lt;SecretManagerSection&gt;&lt;currentId&gt;0&lt;/currentId&gt;&lt;tokenSequenceNumber&gt;0&lt;/tokenSequenceNumber&gt;&lt;numDelegationKeys&gt;0&lt;/numDelegationKeys&gt;&lt;numTokens&gt;0&lt;/numTokens&gt;&lt;/SecretManagerSection&gt;&lt;CacheManagerSection&gt;&lt;nextDirectiveId&gt;1&lt;/nextDirectiveId&gt;&lt;numDirectives&gt;0&lt;/numDirectives&gt;&lt;numPools&gt;0&lt;/numPools&gt;&lt;/CacheManagerSection&gt;</span><br><span class="line">&lt;/fsimage&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="查看edits文件"><a href="#查看edits文件" class="headerlink" title="查看edits文件"></a>查看edits文件</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hdfs oev -p 转换后文件类型 -i 编辑日志 -o 转换后文件输出路径</span><br><span class="line"></span><br><span class="line"> hdfs oev -p xml -i edits_0000000000000000001-0000000000000000002 -o ~/edit_1.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="DataNode工作机制"><a href="#DataNode工作机制" class="headerlink" title="DataNode工作机制"></a>DataNode工作机制</h1><p>一个数据块在DataNode上以文字形式存储在磁盘上，包括两个文件，一个是数据本身，<code>.meta</code>包含数据的长度，块数据的校验和，时间戳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1/data/dfs/data/current/BP-725394105-127.0.1.1-1625319364440/current/finalized/subdir0/subdir0$ ll</span><br><span class="line">总用量 4240</span><br><span class="line">drwxrwxr-x 2 lowkeysp-00 lowkeysp-00   4096 7月   4 22:53 ./</span><br><span class="line">drwxrwxr-x 3 lowkeysp-00 lowkeysp-00   4096 7月   3 23:37 ../</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00     16 7月   3 23:37 blk_1073741825</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00     11 7月   3 23:37 blk_1073741825_1001.meta</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00 280989 7月   3 23:47 blk_1073741826</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00   2203 7月   3 23:47 blk_1073741826_1002.meta</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>1）DataNode启动后向NameNode注册，通过后，周期性（6小时）向NameNode上报所有块信息<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.blockreport.intervalMsec&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;21600000&lt;/value&gt;</span><br><span class="line">&lt;/property&gt; </span><br></pre></td></tr></table></figure>
DataNode再汇报前，会先自查自己本身的块信息，扫描自己节点块信息的时间间隔也是6小时<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.datanode.directoryscan.interval&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;21600s&lt;/value&gt;</span><br><span class="line">&lt;/property&gt; </span><br></pre></td></tr></table></figure></li>
<li>2)心跳是每3秒一次，告诉NameNode还活着，心跳返回的结果会包括NameNode给该DataNode的命令结果。如果超过10分钟+30s心跳没有收到某个DataNode的心跳，则认为该节点不可用。</li>
</ul>
<p> 超时10分钟的计算：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TimeOut = 2 * dfs.namenode.heartbeat.recheck-interval + 10 * dfs.heartbeat.interval</span><br><span class="line"></span><br><span class="line">dfs.namenode.heartbeat.recheck-interval 默认是5分钟，dfs.heartbeat.interval默认是3秒</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/07/HDFS%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/07/07/HDFS%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">HDFS读写数据</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-07-07 13:59:38" itemprop="dateCreated datePublished" datetime="2021-07-07T13:59:38+08:00">2021-07-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/07/07/HDFS%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE/" class="leancloud_visitors" data-flag-title="HDFS读写数据">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/05/HDFS%E7%9A%84shell%E5%91%BD%E4%BB%A4/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/07/05/HDFS%E7%9A%84shell%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">HDFS的shell命令</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-07-05 10:09:42" itemprop="dateCreated datePublished" datetime="2021-07-05T10:09:42+08:00">2021-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/07/05/HDFS%E7%9A%84shell%E5%91%BD%E4%BB%A4/" class="leancloud_visitors" data-flag-title="HDFS的shell命令">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># 创建目录</span><br><span class="line">hadoop fs -mkdir /d</span><br><span class="line"></span><br><span class="line"># 从本地剪切到HDFS上，注意是剪切，上传之后，本地就没有了</span><br><span class="line">hadoop fs -moveFromLocal 本地文件  HDFS目录</span><br><span class="line"></span><br><span class="line"># 从本地复制到HDFS上</span><br><span class="line">hadoop fs -copyFromLocal 本地文件  HDFS目录</span><br><span class="line"></span><br><span class="line"># 跟copyFromLocal作用一样</span><br><span class="line">hadoop fs -put 本地文件  HDFS目录</span><br><span class="line"></span><br><span class="line"># 追加一个文件到已经存在的文件末尾</span><br><span class="line">hadoop fs -appendToFile 本地文件  HDFS文件</span><br><span class="line"></span><br><span class="line"># 从HDFS下载到本地</span><br><span class="line">hadoop fs -copyToLocal HDFS文件  本地目录</span><br><span class="line"></span><br><span class="line"># 跟copyToLocal作用一样</span><br><span class="line">hadoop fs -get HDFS文件  本地目录</span><br><span class="line"></span><br><span class="line"># 显示目录信息</span><br><span class="line">hadoop fs -ls HDFS目录</span><br><span class="line"></span><br><span class="line"># 显示文件内容</span><br><span class="line">hadoop fs -cat HDFS文件</span><br><span class="line"></span><br><span class="line"># 修改权限</span><br><span class="line">hadoop fs -chgrp</span><br><span class="line">          -chmod</span><br><span class="line">          -chown</span><br><span class="line"></span><br><span class="line"># 创建目录</span><br><span class="line">hadoop fs -mkdir</span><br><span class="line"></span><br><span class="line"># 复制</span><br><span class="line">hadoop fs -cp </span><br><span class="line"></span><br><span class="line"># 移动</span><br><span class="line">hadoop fs -mv</span><br><span class="line"></span><br><span class="line"># 显示文件尾的内容</span><br><span class="line">hadoop fs -tail</span><br><span class="line"></span><br><span class="line"># 删除</span><br><span class="line">hadoop fs -rm</span><br><span class="line"></span><br><span class="line">#递归删除</span><br><span class="line">hadoop fs -rm -r</span><br><span class="line"></span><br><span class="line">#统计文件夹的大小信息</span><br><span class="line">hadoop fs -du</span><br><span class="line"></span><br><span class="line"># 设置HDFS中文件的副本数量</span><br><span class="line">hadoop fs -setrep 副本数量 HDFS文件</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/02/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/07/02/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">hadoop集群搭建</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-07-02 22:10:24" itemprop="dateCreated datePublished" datetime="2021-07-02T22:10:24+08:00">2021-07-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/07/02/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" class="leancloud_visitors" data-flag-title="hadoop集群搭建">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<p>可以使用VMWARE PRO软件，创建若干个Linux虚拟机，进行Hadoop的集群搭建</p>
<p>使用VMWARE创建虚拟机后，需要通过xshell远程登陆linux服务器，具体操作如下：</p>
<h1 id="xshell远程登陆linux服务器"><a href="#xshell远程登陆linux服务器" class="headerlink" title="xshell远程登陆linux服务器"></a>xshell远程登陆linux服务器</h1><h2 id="设置静态IP地址"><a href="#设置静态IP地址" class="headerlink" title="设置静态IP地址"></a>设置静态IP地址</h2><p>在<code>/etc/netplan/</code>目录下，有一个yaml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/etc/netplan$ ls</span><br><span class="line">01-network-manager-all.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对该文件进行编辑，修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Let NetworkManager manage all devices on this system</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: NetworkManager</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:            #通过ifconfig查看网卡</span><br><span class="line">      dhcp4: no        # 不适用DHCP，使用静态</span><br><span class="line">      addresses: [192.168.10.1/24]    # IP地址/掩码</span><br><span class="line">      gateway4: 192.168.10.2      # 网关地址</span><br><span class="line">      nameservers: </span><br><span class="line">          addresses: [192.168.10.2]    # DNS地址</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编辑完成后，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure>
<p>之后，可以通过<code>ifconfig</code>查看确实已经更改为静态地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/etc/netplan$ ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.10.1  netmask 255.255.255.0  broadcast 192.168.10.255</span><br><span class="line">        inet6 fe80::20c:29ff:fef8:63de  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:f8:63:de  txqueuelen 1000  (以太网)</span><br><span class="line">        RX packets 552  bytes 53961 (53.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 515  bytes 66516 (66.5 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (本地环回)</span><br><span class="line">        RX packets 182  bytes 14978 (14.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 182  bytes 14978 (14.9 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="配置hostname和hosts文件"><a href="#配置hostname和hosts文件" class="headerlink" title="配置hostname和hosts文件"></a>配置hostname和hosts文件</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 配置hostname，该例子使用了三台虚拟机，分别为lowkeysp-01,lowkeysp-03,lowkeysp-04，则在相应的`/etc/hostname`下配置</span><br><span class="line">lowkeysp-01</span><br><span class="line"></span><br><span class="line"># 配置`/etc/hosts`,。添加</span><br><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1$ cat /etc/hosts</span><br><span class="line"></span><br><span class="line">192.168.10.1  lowkeysp-01</span><br><span class="line">192.168.10.3  lowkeysp-03</span><br><span class="line">192.168.10.4  lowkeysp-04</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="修改VMWare的地址"><a href="#修改VMWare的地址" class="headerlink" title="修改VMWare的地址"></a>修改VMWare的地址</h2><p>【编辑】-【虚拟网络编辑器】</p>
<p>选中 VMnet8 那一行，点击右下角的【更改设置】</p>
<p>之后，将下方的子网IP改为：192.168.10.0，再点击【NAT设置】，网关IP改为：192.168.10.2，点击确定，再点击应用</p>
<h2 id="修改Win系统地址"><a href="#修改Win系统地址" class="headerlink" title="修改Win系统地址"></a>修改Win系统地址</h2><p>【网络和Internet设置】-【更改适配器选项】</p>
<p>选择【VMWare Network Adapter VMNet8】，右键-【属性】，【Internet协议版本4】，点击属性，修改IP地址为：192.168.10.101，默认网关是192.168.10.2，DNS服务器为：8.8.8.8，点击确定</p>
<h2 id="在ubuntu上装SSH服务器，用于SSH登陆"><a href="#在ubuntu上装SSH服务器，用于SSH登陆" class="headerlink" title="在ubuntu上装SSH服务器，用于SSH登陆"></a>在ubuntu上装SSH服务器，用于SSH登陆</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>

<h2 id="使用xshell，用ssh方式即可登陆"><a href="#使用xshell，用ssh方式即可登陆" class="headerlink" title="使用xshell，用ssh方式即可登陆"></a>使用xshell，用ssh方式即可登陆</h2><p>这时候，就可以通过xshell远程登陆了</p>
<p>可以通过VMWARE的克隆功能，将虚拟机克隆成多个虚拟机，减少重复配置，注意，每一个虚拟机需要配置不同的ip地址</p>
<h1 id="虚拟机上Hadoop和Java的安装"><a href="#虚拟机上Hadoop和Java的安装" class="headerlink" title="虚拟机上Hadoop和Java的安装"></a>虚拟机上Hadoop和Java的安装</h1><p>在&#x2F;opt下创建两个目录，一个是software，一个是module，其中，software用来放软件包，module放解压后的软件</p>
<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs2yw7yh6oj30sm08x78w.jpg" alt="捕获.PNG"></p>
<p>更改目录的所有者，变成lowkeysp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown lowkeysp:lowkeysp software/ module/</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs2yxprs0lj30sy05qacz.jpg" alt="捕获.PNG"></p>
<p>之后，将下载好的jdk和hadoop的包放到software目录下，然后解压到module目录下</p>
<p>配置环境变量</p>
<p>在<code>/etc/profile.d/</code>目录下，创建一个<code>hadoop_java_env.sh</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Java Home</span><br><span class="line">export JAVA_HOME=/opt/module/jdk-11.0.11</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Hadoop Home</span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-3.3.1</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样，环境变量就配置完成</p>
<h1 id="分发脚本"><a href="#分发脚本" class="headerlink" title="分发脚本"></a>分发脚本</h1><h2 id="两个命令的解释"><a href="#两个命令的解释" class="headerlink" title="两个命令的解释"></a>两个命令的解释</h2><p>scp(secure copy)命令： 将文件从一个服务器传送到另一个服务器上，</p>
<p>基本语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r source_user@source_hostpdir/fname   dst_user@dst_host:pdir/fname</span><br></pre></td></tr></table></figure>
<p>其中，-r表示递归，将目录下的文件都传送到目的服务器上。pdir是目录，fname是目录下的文件名称。user是目的地用户，host是主机地址。</p>
<p>rsync 主要用于备份和镜像，具有速度快，避免复制相同内容和支持符号链接的优点</p>
<p>rsync和scp的区别：用rsync做文件的复制比scp的速度快，rsync只对差异化文件做更新，而scp是把所有文件都复制过去。</p>
<p>基本语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av   source_user@source_hostpdir/fname   dst_user@dst_host:pdir/fname</span><br></pre></td></tr></table></figure>
<p>-a 归档拷贝,-v显示复制过程</p>
<h2 id="SSH免密登陆"><a href="#SSH免密登陆" class="headerlink" title="SSH免密登陆"></a>SSH免密登陆</h2><p>比如，如果192.168.10.1 需要免密登陆 192.168.10.2，那么操作如下：</p>
<p>在192.168.10.1上,执行如下命令，形成一组公钥，私钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p>将公钥发送给192.168.10.2，输入命令后，回车，得输入一个yes，才能推送成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id 192.168.10.2</span><br></pre></td></tr></table></figure>

<p>这样192.168.10.1就能免密登陆 192.168.10.2了</p>
<h2 id="具体分发脚本"><a href="#具体分发脚本" class="headerlink" title="具体分发脚本"></a>具体分发脚本</h2><p>shell文件名: xsync</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断参数个数，如果参数个数小于1，该命令需要参数至少有1个</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then </span><br><span class="line">    echo Not Enough Arguement!</span><br><span class="line">    exit;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">遍及所有的集群</span></span><br><span class="line"></span><br><span class="line">for host in 192.168.10.3 192.168.10.4</span><br><span class="line">do</span><br><span class="line">    echo ===============================$host========================</span><br><span class="line">    </span><br><span class="line">    for file in $@</span><br><span class="line">    do</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">判断文件是否存在</span></span><br><span class="line">        if [ -e $file ]</span><br><span class="line">            then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">获取父目录，<span class="built_in">dirname</span> <span class="variable">$file</span> 可以获取父目录，<span class="built_in">pwd</span>是显示目录，-P表示忽略软连接</span></span><br><span class="line">		pdir=$(cd -P $(dirname $file); pwd)</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">获取当前文件的名称</span></span><br><span class="line">		fname=$(basename $file)</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">登陆host主机，并且创建一个目录，-p表示如果目录存在的话，则忽略,不然会报错</span></span><br><span class="line">		ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">                #将文件复制到host里面去</span><br><span class="line">		rsync -av $pdir/$fname $host:$pdir</span><br><span class="line">	    else</span><br><span class="line">		echo $file does not exits!</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">    done</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>保存退出后，需要变成可执行文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 775 xsync</span><br></pre></td></tr></table></figure>


<p>之后，就可以执行分发了</p>
<p>比如分发hadoop和java的环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./xsync /etc/profile.d/hadoop_java_env.sh</span><br></pre></td></tr></table></figure>


<h1 id="集群的配置"><a href="#集群的配置" class="headerlink" title="集群的配置"></a>集群的配置</h1><h2 id="集群的部署规划："><a href="#集群的部署规划：" class="headerlink" title="集群的部署规划："></a>集群的部署规划：</h2><ul>
<li>NameNode和SecondaryNameNode不要安装在同一个台服务器上</li>
<li>ResourceManager也很消耗内存，不要和NameNode和SecondaryNameNode配置在同一台机器上</li>
</ul>
<p>总结：NameNode，SecondaryNameNode，ResourceManager要部署在三台机器上。</p>
<h2 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h2><p>Hadoop配置文件分两类：默认配置文件和自定义配置文件。当用户想修改某一默认配置时，需要修改自定义配置文件，更改相应属性值</p>
<h3 id="默认配置文件的位置："><a href="#默认配置文件的位置：" class="headerlink" title="默认配置文件的位置："></a>默认配置文件的位置：</h3><ul>
<li><p>core-default.xml 文件放在hadoop的jar包中的 hadoop-common-3.3.1.jar&#x2F;core-default.xml</p>
</li>
<li><p>hdfs-default.xml 文件放在hadoop的jar包中的 hadoop-hdfs-3.3.1.jar&#x2F;hdfs-default.xml</p>
</li>
<li><p>yarn-default.xml 文件放在hadoop的jar包中的 hadoop-yarn-common-3.3.1.jar&#x2F;yarn-default.xml</p>
</li>
<li><p>mapred-default.xml 文件放在hadoop的jar包中的 hadoop-mapreduce-client-core-3.3.1.jar&#x2F;mapred-default.xml</p>
</li>
</ul>
<h3 id="自定义配置文件的位置"><a href="#自定义配置文件的位置" class="headerlink" title="自定义配置文件的位置"></a>自定义配置文件的位置</h3><p>core-site.xml,hdfs-site.xml,yarn-site.xml,mapred-site.xml 四个配置文件均存放在 <code>$HADOOP_HOME/etc/hadoop</code>下，用户可以根据自己的需求对其进行重新配置</p>
<h3 id="文件的配置"><a href="#文件的配置" class="headerlink" title="文件的配置"></a>文件的配置</h3><p>假设，使用三台主机，搭建hadoop集群，地址分别为192.168.10.1，192.168.10.3，192.168.10.4。</p>
<p>配置策略如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>192.168.10.1</th>
<th>192.168.10.3</th>
<th>192.168.10.4</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td>NameNode DataNode</td>
<td>DataNode</td>
<td>SecondaryNameNode DataNode</td>
</tr>
<tr>
<td>HDFS</td>
<td>NodeManager</td>
<td>ResourceManager NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<ul>
<li>配置core-site.xml</li>
</ul>
<p>指定了NameNode的地址，以及Hadoop的数据存储位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Put site-specific property overrides in this file. --&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- 指定NameNode的地址--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;hdfs://192.168.10.1:8020&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;!-- 指定hadoop数据的存储目录 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;/opt/module/hadoop-3.3.1/data&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置hdfs-site.xml</li>
</ul>
<p>配置了NameNode和SecondaryNameNode的Web端访问地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Put site-specific property overrides in this file. --&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--  NameNode的web端访问地址--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">	    &lt;name&gt;dfs.namenode.http-address&lt;/name&gt;</span><br><span class="line">	    &lt;value&gt;192.168.10.1:9870&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- SecondaryNameNode的Web端访问地址--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">	    &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;192.168.10.4:9868&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置yarn-site.xml</li>
</ul>
<p>指定了ResourceManager为192.168.10.3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Site specific YARN configuration properties --&gt;</span><br><span class="line">    &lt;!-- 指定Map Reduce走shuffle--&gt;	</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">	    &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--  指定ResourceManager 的地址--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">	&lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;192.168.10.3&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置mapred-site.xml文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- Put site-specific property overrides in this file. --&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 指定mapreduce程序运行在Yarn上--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">	    &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置Workers"><a href="#配置Workers" class="headerlink" title="配置Workers"></a>配置Workers</h2><p>在<code>/opt/module/hadoop-3.3.1/etc/hadoop/</code>目录下，有一个workers文件，在workers中增加内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.10.1</span><br><span class="line">192.168.10.3</span><br><span class="line">192.168.10.4</span><br></pre></td></tr></table></figure>
<p>注意，该文件中添加的内容结尾不允许有空格，文件中不允许有空行</p>
<p>之后，同步配置到所有节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/xsync workers</span><br></pre></td></tr></table></figure>

<h2 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h2><p>1）如果集群是第一次启动，需要在192.168.10.1节点格式化NameNode（<strong>注意：格式化NameNode，会产生新的集群ID，导致NameNode和DataNode的集群ID不一致，集群找不到以往数据。如果集群在运行过程中报错，需要重新格式化NameNode的话，一定要先停止NameNode和DataNode进程，并且要删除所有机器的data和logs目录，然后再进行格式化</strong>）</p>
<h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ hdfs namenode -format</span><br></pre></td></tr></table></figure>
<p>格式化完成后，会发现，目录下多个两个目录,data目录和logs目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ ls</span><br><span class="line">bin   etc      lib      LICENSE-binary   LICENSE.txt  NOTICE-binary  README.txt  share</span><br><span class="line">data  include  libexec  licenses-binary  logs         NOTICE.txt     sbin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>进入到data目录，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hadoop-3.3.1/data/dfs/name/current</span><br><span class="line"></span><br><span class="line">在current目录下，有以下文件</span><br><span class="line"></span><br><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1/data/dfs/name/current$ ls</span><br><span class="line">fsimage_0000000000000000000  fsimage_0000000000000000000.md5  seen_txid  VERSION</span><br><span class="line"></span><br><span class="line">其中，VERSION文件里为：</span><br><span class="line">#Sat Jul 03 21:36:04 CST 2021</span><br><span class="line">namespaceID=159680868</span><br><span class="line">blockpoolID=BP-725394105-127.0.1.1-1625319364440</span><br><span class="line">storageType=NAME_NODE</span><br><span class="line">cTime=1625319364440</span><br><span class="line">clusterID=CID-fb46ba01-abfa-4895-b1f0-20cd050a456c</span><br><span class="line">layoutVersion=-66</span><br></pre></td></tr></table></figure>
<h3 id="格式化后，启动hdfs"><a href="#格式化后，启动hdfs" class="headerlink" title="格式化后，启动hdfs"></a>格式化后，启动hdfs</h3><p>启动前，还需要在<code>/opt/module/hadoop-3.3.1/etc/hadoop</code>目录下的<code>hadoop-env.sh</code>文件中添加JAVA_HOME，否则会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"># The java implementation to use. By default, this environment</span><br><span class="line"># variable is REQUIRED on ALL platforms except OS X!</span><br><span class="line">export JAVA_HOME=/opt/module/jdk-11.0.11</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后分发给其他主机，之后，</p>
<p>在192.168.10.1主机上，启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ sbin/start-dfs.sh </span><br><span class="line">Starting namenodes on [192.168.10.1]</span><br><span class="line">192.168.10.1: namenode is running as process 5414.  Stop it first and ensure /tmp/hadoop-lowkeysp-00-namenode.pid file is empty before retry.</span><br><span class="line">Starting datanodes</span><br><span class="line">192.168.10.3: WARNING: /opt/module/hadoop-3.3.1/logs does not exist. Creating.</span><br><span class="line">192.168.10.4: WARNING: /opt/module/hadoop-3.3.1/logs does not exist. Creating.</span><br><span class="line">192.168.10.1: datanode is running as process 5566.  Stop it first and ensure /tmp/hadoop-lowkeysp-00-datanode.pid file is empty before retry.</span><br><span class="line">Starting secondary namenodes [192.168.10.4]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>则启动完毕。</p>
<p>检查一下，</p>
<p>192.168.10.1上,看到有NameNode和DataNode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ jps</span><br><span class="line">5414 NameNode</span><br><span class="line">6253 Jps</span><br><span class="line">5566 DataNode</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在192.168.10.3上，有DataNode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1/etc/hadoop$ jps</span><br><span class="line">3144 DataNode</span><br><span class="line">3257 Jps</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在192.168.10.4上，有SecondaryNameNode和DataNode,跟之前规划部署的都一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:~$ jps</span><br><span class="line">3350 Jps</span><br><span class="line">3243 SecondaryNameNode</span><br><span class="line">3135 DataNode</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>我们可以通过Web页面访问，之前在xml的配置中，有配置面向web的地址，这个是Name Node的Web地址，可以用来查看HDFS上存储的数据情况</p>
<p>NameNode的Web地址:192.168.10.1:9870</p>
<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs463hdyckj31ac0jjac4.jpg" alt="捕获.PNG"></p>
<p>其中，首页就显示了VERSION</p>
<p>常用的是Utilities的Browse the file System,可以查看文件系统的情况，查看HDFS上存储的数据</p>
<h3 id="启动Yarn"><a href="#启动Yarn" class="headerlink" title="启动Yarn"></a>启动Yarn</h3><p>需要注意，之前部署规划时，yarn的ResourceManager是部署在192.168.10.3的，所以需要在192.168.10.3上启动yarn</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ sbin/start-yarn.sh </span><br><span class="line">Starting resourcemanager</span><br><span class="line">resourcemanager is running as process 3370.  Stop it first and ensure /tmp/hadoop-lowkeysp-00-resourcemanager.pid file is empty before retry.</span><br><span class="line">Starting nodemanagers</span><br><span class="line">192.168.10.4: nodemanager is running as process 3470.  Stop it first and ensure /tmp/hadoop-lowkeysp-00-nodemanager.pid file is empty before retry.</span><br><span class="line">192.168.10.1: nodemanager is running as process 6367.  Stop it first and ensure /tmp/hadoop-lowkeysp-00-nodemanager.pid file is empty before retry.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动完成后，查看</p>
<p>192.168.10.1上,看到有NodeManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5414 NameNode</span><br><span class="line">6567 Jps</span><br><span class="line">5566 DataNode</span><br><span class="line">6367 NodeManager</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在192.168.10.3上，有ResourceManager，NodeManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ jps</span><br><span class="line">4209 Jps</span><br><span class="line">3144 DataNode</span><br><span class="line">4058 NodeManager</span><br><span class="line">3370 ResourceManager</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在192.168.10.4上，有NodeManager,跟之前规划部署的都一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:~$ jps</span><br><span class="line">3243 SecondaryNameNode</span><br><span class="line">3470 NodeManager</span><br><span class="line">3822 Jps</span><br><span class="line">3135 DataNode</span><br></pre></td></tr></table></figure>

<p>Yarn也有一个web页面，之前在xml上也配置了，网址为：<a target="_blank" rel="noopener" href="http://192.168.10.3:8088/">http://192.168.10.3:8088/</a>   （后面的8088是固定的，xml也没有这个8088）</p>
<h3 id="集群基本测试"><a href="#集群基本测试" class="headerlink" title="集群基本测试"></a>集群基本测试</h3><p>这样，集群就搭建运行起来了，我们进行一个小的测试</p>
<p>上传数据到hdfs上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 创建了一个目录，这个目录是在/目录下，这里的根目录不是服务器上实际的根目录，而是hdfs上面的根目录</span><br><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ hadoop fs -mkdir /wcinput</span><br></pre></td></tr></table></figure>
<p>查看页面，确实也有了一个目录<br><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs46ofzcq8j31do0hg0tk.jpg" alt="捕获.PNG"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 上传文件,将本地的a.txt文件上传到了/wcinput目录下</span><br><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1$ hadoop fs -put ./aa.txt /wcinput</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs46rxvdwlj31eb0ghgmj.jpg" alt="捕获.PNG"></p>
<p>其实，这些数据实际存储在core-site.xml里面当时指定的hadoop数据的存储目录下，这里也就是<code>/opt/module/hadoop-3.3.1/data</code>目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hadoop-3.3.1/data/dfs/data/current/BP-725394105-127.0.1.1-1625319364440/current/finalized/subdir0/subdir0</span><br><span class="line"></span><br><span class="line">这个目录下有以下文件</span><br><span class="line"></span><br><span class="line">lowkeysp-00@lowkeysp-00:/opt/module/hadoop-3.3.1/data/dfs/data/current/BP-725394105-127.0.1.1-1625319364440/current/finalized/subdir0/subdir0$ ll</span><br><span class="line">总用量 16</span><br><span class="line">drwxrwxr-x 2 lowkeysp-00 lowkeysp-00 4096 7月   3 23:37 ./</span><br><span class="line">drwxrwxr-x 3 lowkeysp-00 lowkeysp-00 4096 7月   3 23:37 ../</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00   16 7月   3 23:37 blk_1073741825</span><br><span class="line">-rw-rw-r-- 1 lowkeysp-00 lowkeysp-00   11 7月   3 23:37 blk_1073741825_1001.meta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat blk_1073741825</span><br><span class="line">a</span><br><span class="line">aa</span><br><span class="line">aaaaa</span><br><span class="line">aa</span><br><span class="line">a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">所以这个文件就是之前的aa.txt</span><br></pre></td></tr></table></figure>

<p>而且，上传文件后，不光是上传到了192.168.10.1上，而是存储到了三台（Replication&#x3D;3）DataNode上</p>
<p>执行wordcount</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar wordcount /wcinput /wcoutput</span><br><span class="line">2021-07-04 20:30:04,464 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at /192.168.10.3:8032</span><br><span class="line">2021-07-04 20:30:04,875 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/lowkeysp-00/.staging/job_1625401657661_0001</span><br><span class="line">2021-07-04 20:30:05,214 INFO input.FileInputFormat: Total input files to process : 1</span><br><span class="line">2021-07-04 20:30:05,330 INFO mapreduce.JobSubmitter: number of splits:1</span><br><span class="line">2021-07-04 20:30:05,618 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1625401657661_0001</span><br><span class="line">2021-07-04 20:30:05,618 INFO mapreduce.JobSubmitter: Executing with tokens: []</span><br><span class="line">2021-07-04 20:30:05,793 INFO conf.Configuration: resource-types.xml not found</span><br><span class="line">2021-07-04 20:30:05,793 INFO resource.ResourceUtils: Unable to find &#x27;resource-types.xml&#x27;.</span><br><span class="line">2021-07-04 20:30:06,184 INFO impl.YarnClientImpl: Submitted application application_1625401657661_0001</span><br><span class="line">2021-07-04 20:30:06,229 INFO mapreduce.Job: The url to track the job: http://lowkeysp-03:8088/proxy/application_1625401657661_0001/</span><br><span class="line">2021-07-04 20:30:06,230 INFO mapreduce.Job: Running job: job_1625401657661_0001</span><br><span class="line">2021-07-04 20:30:13,461 INFO mapreduce.Job: Job job_1625401657661_0001 running in uber mode : false</span><br><span class="line">2021-07-04 20:30:13,463 INFO mapreduce.Job:  map 0% reduce 0%</span><br><span class="line">2021-07-04 20:30:20,540 INFO mapreduce.Job:  map 100% reduce 0%</span><br><span class="line">2021-07-04 20:30:25,573 INFO mapreduce.Job:  map 100% reduce 100%</span><br><span class="line">2021-07-04 20:30:26,586 INFO mapreduce.Job: Job job_1625401657661_0001 completed successfully</span><br><span class="line">2021-07-04 20:30:26,660 INFO mapreduce.Job: Counters: 54</span><br><span class="line">	File System Counters</span><br><span class="line">		FILE: Number of bytes read=35</span><br><span class="line">		FILE: Number of bytes written=544757</span><br><span class="line">		FILE: Number of read operations=0</span><br><span class="line">		FILE: Number of large read operations=0</span><br><span class="line">		FILE: Number of write operations=0</span><br><span class="line">		HDFS: Number of bytes read=120</span><br><span class="line">		HDFS: Number of bytes written=17</span><br><span class="line">		HDFS: Number of read operations=8</span><br><span class="line">		HDFS: Number of large read operations=0</span><br><span class="line">		HDFS: Number of write operations=2</span><br><span class="line">		HDFS: Number of bytes read erasure-coded=0</span><br><span class="line">	Job Counters </span><br><span class="line">		Launched map tasks=1</span><br><span class="line">		Launched reduce tasks=1</span><br><span class="line">		Data-local map tasks=1</span><br><span class="line">		Total time spent by all maps in occupied slots (ms)=3893</span><br><span class="line">		Total time spent by all reduces in occupied slots (ms)=2872</span><br><span class="line">		Total time spent by all map tasks (ms)=3893</span><br><span class="line">		Total time spent by all reduce tasks (ms)=2872</span><br><span class="line">		Total vcore-milliseconds taken by all map tasks=3893</span><br><span class="line">		Total vcore-milliseconds taken by all reduce tasks=2872</span><br><span class="line">		Total megabyte-milliseconds taken by all map tasks=3986432</span><br><span class="line">		Total megabyte-milliseconds taken by all reduce tasks=2940928</span><br><span class="line">	Map-Reduce Framework</span><br><span class="line">		Map input records=5</span><br><span class="line">		Map output records=5</span><br><span class="line">		Map output bytes=36</span><br><span class="line">		Map output materialized bytes=35</span><br><span class="line">		Input split bytes=104</span><br><span class="line">		Combine input records=5</span><br><span class="line">		Combine output records=3</span><br><span class="line">		Reduce input groups=3</span><br><span class="line">		Reduce shuffle bytes=35</span><br><span class="line">		Reduce input records=3</span><br><span class="line">		Reduce output records=3</span><br><span class="line">		Spilled Records=6</span><br><span class="line">		Shuffled Maps =1</span><br><span class="line">		Failed Shuffles=0</span><br><span class="line">		Merged Map outputs=1</span><br><span class="line">		GC time elapsed (ms)=61</span><br><span class="line">		CPU time spent (ms)=1670</span><br><span class="line">		Physical memory (bytes) snapshot=520179712</span><br><span class="line">		Virtual memory (bytes) snapshot=5475196928</span><br><span class="line">		Total committed heap usage (bytes)=325058560</span><br><span class="line">		Peak Map Physical memory (bytes)=305750016</span><br><span class="line">		Peak Map Virtual memory (bytes)=2729951232</span><br><span class="line">		Peak Reduce Physical memory (bytes)=214429696</span><br><span class="line">		Peak Reduce Virtual memory (bytes)=2745245696</span><br><span class="line">	Shuffle Errors</span><br><span class="line">		BAD_ID=0</span><br><span class="line">		CONNECTION=0</span><br><span class="line">		IO_ERROR=0</span><br><span class="line">		WRONG_LENGTH=0</span><br><span class="line">		WRONG_MAP=0</span><br><span class="line">		WRONG_REDUCE=0</span><br><span class="line">	File Input Format Counters </span><br><span class="line">		Bytes Read=16</span><br><span class="line">	File Output Format Counters </span><br><span class="line">		Bytes Written=17</span><br></pre></td></tr></table></figure>
<p>则，计算成功</p>
<p>在相应的Web网页上也能看到相应的信息和结果</p>
<h2 id="集群崩溃异常如何处理"><a href="#集群崩溃异常如何处理" class="headerlink" title="集群崩溃异常如何处理"></a>集群崩溃异常如何处理</h2><p>处理方法：格式化NameNode</p>
<p>第一步：先停掉进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sbin/stop-dfs.sh</span><br><span class="line">sbin/stop-yarn.sh</span><br></pre></td></tr></table></figure>

<p>第二步，删掉data&#x2F;和logs&#x2F;,所有的机器都要删掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf data/ logs/</span><br></pre></td></tr></table></figure>


<p>第三步，格式化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure>

<h2 id="配置历史服务器"><a href="#配置历史服务器" class="headerlink" title="配置历史服务器"></a>配置历史服务器</h2><p>为了查看程序的历史运行情况，需要配置一下历史服务器。具体配置步骤如下：</p>
<p>配置 etc&#x2F;hadoop&#x2F;mapred-site.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 历史服务器地址，对内--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;192.168.10.1:10020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--  历史服务器Web地址，对外--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;192.168.10.1:19888&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分发配置给其他服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/xsync etc/hadoop/mapred-site.xml </span><br></pre></td></tr></table></figure>

<p>关闭yarn进程</p>
<p>在192.168.10.1上启动历史服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bin/mapred --daemon start historyserver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动之后，查看确实多了一个jobhistoryserver</span><br><span class="line"></span><br><span class="line">lowkeysp-00@lowkeysp-01:/opt/module/hadoop-3.3.1$ jps</span><br><span class="line">2161 NameNode</span><br><span class="line">2311 DataNode</span><br><span class="line">23528 Jps</span><br><span class="line">23146 JobHistoryServer</span><br><span class="line">18335 NodeManager</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>启动历史服务器之后，就可以在网页上查看<br><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs57w8gqxcj61c00k0tas02.jpg" alt="捕获.PNG"></p>
<h2 id="配置日志的聚集"><a href="#配置日志的聚集" class="headerlink" title="配置日志的聚集"></a>配置日志的聚集</h2><p>日志聚集概念：应用运行完成后，将程序运行日志信息上传到HDFS上。从而可以方便查看到程序的运行详情，方便开发调试</p>
<p>注意：开启日志聚集功能，需要重新启动NodeManager,ResourceManager和HistoryServer</p>
<p>配置yarn-site.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--开启日志聚集功能    --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 设置日志聚集服务器的地址--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.log.server.url&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;http://192.168.10.1:19888/jobhistory/logs&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 设置日志保留时间为7天--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;604800&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分发配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/xsync etc/hadoop/yarn-site.xm</span><br></pre></td></tr></table></figure>

<p>关闭NodeManager,ResourceManager和HistoryServer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sbin/stop-yarn.sh</span><br><span class="line"></span><br><span class="line">mapred --daemon stop historyserver</span><br></pre></td></tr></table></figure>


<p>再打开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-yarn.sh</span><br><span class="line"></span><br><span class="line">mapred --daemon start historyserver</span><br></pre></td></tr></table></figure>

<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gs5b3xq0axj31es0krwgu.jpg" alt="捕获.PNG"></p>
<h2 id="逐一开启-x2F-停止hdfs和yarn的组件"><a href="#逐一开启-x2F-停止hdfs和yarn的组件" class="headerlink" title="逐一开启&#x2F;停止hdfs和yarn的组件"></a>逐一开启&#x2F;停止hdfs和yarn的组件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 分别开启/停止namenode/datanode/secondarynamenode</span><br><span class="line">hdfs --daemon start/stop namenode/datanode/secondarynamenode</span><br><span class="line"></span><br><span class="line"># </span><br><span class="line"># 分别开启/停止resourcemanager/nodemanager</span><br><span class="line">yarn --daemon start/stop resourcemanager/nodemanager</span><br></pre></td></tr></table></figure>

<h2 id="开启集群的脚本和查看进程的脚本"><a href="#开启集群的脚本和查看进程的脚本" class="headerlink" title="开启集群的脚本和查看进程的脚本"></a>开启集群的脚本和查看进程的脚本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">    echo &quot;No Args Input...&quot;</span><br><span class="line">    exit;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)</span><br><span class="line">    echo &quot;================================启动Hadoop集群====================&quot;</span><br><span class="line"></span><br><span class="line">    echo &quot;================================启动HDFS==========================&quot;</span><br><span class="line">    ssh 192.168.10.1 &quot;/opt/module/hadoop-3.3.1/sbin/start-dfs.sh&quot;</span><br><span class="line">    echo &quot;================================启动Yarn==========================&quot;</span><br><span class="line">    ssh 192.168.10.3 &quot;/opt/module/hadoop-3.3.1/sbin/start-yarn.sh&quot;</span><br><span class="line">    echo &quot;================================启动historyserver==========================&quot;</span><br><span class="line">    ssh 192.168.10.1 &quot;/opt/module/hadoop-3.3.1/bin/mapred --daemon start historyserver&quot;</span><br><span class="line"></span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)</span><br><span class="line">    echo &quot;================================关闭Hadoop集群====================&quot;</span><br><span class="line"></span><br><span class="line">    echo &quot;================================关闭historyserver==========================&quot;</span><br><span class="line">    ssh 192.168.10.1 &quot;/opt/module/hadoop-3.3.1/bin/mapred --daemon stop historyserver&quot;</span><br><span class="line">    echo &quot;===============================关闭Yarn==========================&quot;</span><br><span class="line">    ssh 192.168.10.3 &quot;/opt/module/hadoop-3.3.1/sbin/stop-yarn.sh&quot;</span><br><span class="line">    echo &quot;================================关闭HDFS==========================&quot;</span><br><span class="line">    ssh 192.168.10.1 &quot;/opt/module/hadoop-3.3.1/sbin/stop-dfs.sh&quot;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>查看各节点进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">  </span><br><span class="line">for host in 192.168.10.1 192.168.10.3 192.168.10.4</span><br><span class="line">do</span><br><span class="line">    echo ========================$host========================</span><br><span class="line">    ssh $host &quot;/opt/module/jdk-11.0.11/bin/jps&quot;</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="常用端口号"><a href="#常用端口号" class="headerlink" title="常用端口号"></a>常用端口号</h2><p>hadoop3.X</p>
<blockquote>
<ul>
<li>HDFS NameNode 内部通信端口：8020&#x2F;9000&#x2F;9820</li>
<li>HDFS NameNode 对外的查询端口：9870</li>
<li>Yarn查看任务情况的端口：8088</li>
<li>历史服务器：19888</li>
</ul>
</blockquote>
<p>hadoop2.X</p>
<blockquote>
<ul>
<li>HDFS NameNode 内部通信端口：8020&#x2F;9000</li>
<li>HDFS NameNode 对外的查询端口：50070</li>
<li>Yarn查看任务情况的端口：8088</li>
<li>历史服务器：19888</li>
</ul>
</blockquote>
<h2 id="服务器时间同步"><a href="#服务器时间同步" class="headerlink" title="服务器时间同步"></a>服务器时间同步</h2><p>如果服务器能与外网连接，则不需要时间同步，否则，需要时间同步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/06/27/ubuntu%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81ip-xshell%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86ubuntu/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/06/27/ubuntu%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81ip-xshell%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86ubuntu/" class="post-title-link" itemprop="url">ubuntu设置静态ip-xshell远程登陆ubuntu</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-06-27 16:02:37" itemprop="dateCreated datePublished" datetime="2021-06-27T16:02:37+08:00">2021-06-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/06/27/ubuntu%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81ip-xshell%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86ubuntu/" class="leancloud_visitors" data-flag-title="ubuntu设置静态ip-xshell远程登陆ubuntu">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<h1 id="设置静态IP地址"><a href="#设置静态IP地址" class="headerlink" title="设置静态IP地址"></a>设置静态IP地址</h1><p>在<code>/etc/netplan/</code>目录下，有一个yaml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/etc/netplan$ ls</span><br><span class="line">01-network-manager-all.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对该文件进行编辑，修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Let NetworkManager manage all devices on this system</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: NetworkManager</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:            #通过ifconfig查看网卡</span><br><span class="line">      dhcp4: no        # 不适用DHCP，使用静态</span><br><span class="line">      addresses: [192.168.10.1/24]    # IP地址/掩码</span><br><span class="line">      gateway4: 192.168.10.2      # 网关地址</span><br><span class="line">      nameservers: </span><br><span class="line">          addresses: [192.168.10.2]    # DNS地址</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编辑完成后，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure>
<p>之后，可以通过<code>ifconfig</code>查看确实已经更改为静态地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">lowkeysp-00@lowkeysp-00:/etc/netplan$ ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.10.1  netmask 255.255.255.0  broadcast 192.168.10.255</span><br><span class="line">        inet6 fe80::20c:29ff:fef8:63de  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:f8:63:de  txqueuelen 1000  (以太网)</span><br><span class="line">        RX packets 552  bytes 53961 (53.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 515  bytes 66516 (66.5 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (本地环回)</span><br><span class="line">        RX packets 182  bytes 14978 (14.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 182  bytes 14978 (14.9 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="修改VMWare的地址"><a href="#修改VMWare的地址" class="headerlink" title="修改VMWare的地址"></a>修改VMWare的地址</h1><p>【编辑】-【虚拟网络编辑器】</p>
<p>选中 VMnet8 那一行，点击右下角的【更改设置】</p>
<p>之后，将下方的子网IP改为：192.168.10.0，再点击【NAT设置】，网关IP改为：192.168.10.2，点击确定，再点击应用</p>
<h1 id="修改Win系统地址"><a href="#修改Win系统地址" class="headerlink" title="修改Win系统地址"></a>修改Win系统地址</h1><p>【网络和Internet设置】-【更改适配器选项】</p>
<p>选择【VMWare Network Adapter VMNet8】，右键-【属性】，【Internet协议版本4】，点击属性，修改IP地址为：192.168.10.101，默认网关是192.168.10.2，DNS服务器为：8.8.8.8，点击确定</p>
<h1 id="在ubuntu上装SSH服务器，用于SSH登陆"><a href="#在ubuntu上装SSH服务器，用于SSH登陆" class="headerlink" title="在ubuntu上装SSH服务器，用于SSH登陆"></a>在ubuntu上装SSH服务器，用于SSH登陆</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>

<h1 id="使用xshell，用ssh方式即可登陆"><a href="#使用xshell，用ssh方式即可登陆" class="headerlink" title="使用xshell，用ssh方式即可登陆"></a>使用xshell，用ssh方式即可登陆</h1>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/06/08/hadoop%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/06/08/hadoop%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">hadoop基本框架学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-06-08 17:13:11" itemprop="dateCreated datePublished" datetime="2021-06-08T17:13:11+08:00">2021-06-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2021/06/08/hadoop%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/" class="leancloud_visitors" data-flag-title="hadoop基本框架学习">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<h1 id="Hadoop基本框架"><a href="#Hadoop基本框架" class="headerlink" title="Hadoop基本框架"></a>Hadoop基本框架</h1><h1 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h1><p>HDFS是Hadoop Distributed File System(分布式文件系统)</p>
<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gruj58bijpj60pw0h4q3e02.jpg" alt="捕获.PNG"></p>
<p>HDFS采用master&#x2F;slave架构。</p>
<p>一个HDFS集群是由一个Namenode和一定数目的Datanodes组成。</p>
<p>Namenode是一个中心服务器，负责管理文件系统的名字空间(namespace)以及客户端对文件的访问</p>
<p>集群中的Datanode一般是一个节点一个，负责管理它所在节点上的存储</p>
<p>HDFS暴露了文件系统的名字空间，用户能够以文件的形式在上面存储数据。从内部看，一个文件其实被分成一个或多个数据块，这些块存储在一组Datanode上。Namenode执行文件系统的名字空间操作，比如打开、关闭、重命名文件或目录。它也负责确定数据块到具体Datanode节点的映射。Datanode负责处理文件系统客户端的读写请求。在Namenode的统一调度下进行数据块的创建、删除和复制。</p>
<p>一个典型的<strong>部署场景</strong>是一台机器上只运行一个Namenode实例，而集群中的其它机器分别运行一个Datanode实例。这种架构并不排斥在一台机器上运行多个Datanode，只不过这样的情况比较少见。</p>
<p>集群中单一Namenode的结构大大简化了系统的架构。Namenode是所有HDFS元数据的仲裁者和管理者，这样，用户数据永远不会流过Namenode。</p>
<p>HDFS支持传统的层次型文件组织结构。用户或者应用程序可以创建目录，然后将文件保存在这些目录里。文件系统名字空间的层次结构和大多数现有的文件系统类似：用户可以创建、删除、移动或重命名文件。</p>
<p>Namenode负责维护文件系统的名字空间，任何对文件系统名字空间或属性的修改都将被Namenode记录下来。应用程序可以设置HDFS保存的文件的副本数目。文件副本的数目称为文件的副本系数，这个信息也是由Namenode保存的。</p>
<p>HDFS被设计成能够在一个大集群中跨机器可靠地存储超大文件。它将每个文件存储成一系列的数据块，除了最后一个，所有的数据块都是同样大小的。为了容错，文件的所有数据块都会有副本。每个文件的数据块大小和副本系数都是可配置的。应用程序可以指定某个文件的副本数目。副本系数可以在文件创建的时候指定，也可以在之后改变。HDFS中的文件都是一次性写入的，并且严格要求在任何时候只能有一个写入者。</p>
<p>Namenode全权管理数据块的复制，它周期性地从集群中的每个Datanode接收心跳信号和块状态报告(Blockreport)。接收到心跳信号意味着该Datanode节点工作正常。块状态报告包含了一个该Datanode上所有数据块的列表。</p>
<h1 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h1><p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1grum00cmedj30l30gctim.jpg" alt="捕获.PNG"></p>
<h2 id="ResourceManager-全局资源管理和任务调度"><a href="#ResourceManager-全局资源管理和任务调度" class="headerlink" title="ResourceManager: 全局资源管理和任务调度"></a>ResourceManager: 全局资源管理和任务调度</h2><p>负责全局的资源管理和任务调度，把整个集群当成计算资源池，只关注分配，不管应用，且不负责容错</p>
<h3 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h3><p>以前资源是每个节点分成一个个的Map slot和Reduce slot，现在是一个个Container，每个Container可以根据需要运行ApplicationMaster、Map、Reduce或者任意的程序</p>
<p>以前的资源分配是静态的，目前是动态的，资源利用率更高</p>
<p>Container是资源申请的单位，一个资源申请格式：<code>&lt;resource-name, priority, resource-requirement, number-of-containers&gt;, resource-name</code>：主机名、机架名或*（代表任意机器）, resource-requirement：目前只支持CPU和内存</p>
<p>用户提交作业到ResourceManager，然后在某个NodeManager上分配一个Container来运行ApplicationMaster，ApplicationMaster再根据自身程序需要向ResourceManager申请资源</p>
<p>YARN有一套Container的生命周期管理机制，而ApplicationMaster和其Container之间的管理是应用程序自己定义的</p>
<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1grunnt7wi6j30dv0fvq7s.jpg" alt="捕获.PNG"></p>
<h3 id="任务调度"><a href="#任务调度" class="headerlink" title="任务调度"></a>任务调度</h3><p>只关注资源的使用情况，根据需求合理分配资源</p>
<p>Scheluer可以根据申请的需要，在特定的机器上申请特定的资源（ApplicationMaster负责申请资源时的数据本地化的考虑，ResourceManager将尽量满足其申请需求，在指定的机器上分配Container，从而减少数据移动）</p>
<h3 id="内部结构"><a href="#内部结构" class="headerlink" title="内部结构"></a>内部结构</h3><p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gruo2838tdj30gk0c7dlq.jpg" alt="捕获.PNG"></p>
<ul>
<li><p>Client Service: 应用提交、终止、输出信息（应用、队列、集群等的状态信息）</p>
</li>
<li><p>Adaminstration Service: 队列、节点、Client权限管理</p>
</li>
<li><p>ApplicationMasterService: 注册、终止ApplicationMaster, 获取ApplicationMaster的资源申请或取消的请求，并将其异步地传给Scheduler, 单线程处理</p>
</li>
<li><p>ApplicationMaster Liveliness Monitor: 接收ApplicationMaster的心跳消息，如果某个ApplicationMaster在一定时间内没有发送心跳，则被任务失效，其资源将会被回收，然后ResourceManager会重新分配一个ApplicationMaster运行该应用（默认尝试2次）</p>
</li>
<li><p>Resource Tracker Service: 注册节点, 接收各注册节点的心跳消息</p>
</li>
<li><p>NodeManagers Liveliness Monitor: 监控每个节点的心跳消息，如果长时间没有收到心跳消息，则认为该节点无效, 同时所有在该节点上的Container都标记成无效，也不会调度任务到该节点运行</p>
</li>
<li><p>ApplicationManager: 管理应用程序，记录和管理已完成的应用</p>
</li>
<li><p>ApplicationMaster Launcher: 一个应用提交后，负责与NodeManager交互，分配Container并加载ApplicationMaster，也负责终止或销毁</p>
</li>
<li><p>YarnScheduler: 资源调度分配， 有FIFO(with Priority)，Fair，Capacity方式</p>
</li>
<li><p>ContainerAllocationExpirer: 管理已分配但没有启用的Container，超过一定时间则将其回收</p>
</li>
</ul>
<h2 id="NodeManager-单个节点的资源管理和监控"><a href="#NodeManager-单个节点的资源管理和监控" class="headerlink" title="NodeManager: 单个节点的资源管理和监控"></a>NodeManager: 单个节点的资源管理和监控</h2><p>Node节点下的Container管理</p>
<p>启动时向ResourceManager注册并定时发送心跳消息，等待ResourceManager的指令</p>
<p>监控Container的运行，维护Container的生命周期，监控Container的资源使用情况</p>
<p>启动或停止Container，管理任务运行时的依赖包（根据ApplicationMaster的需要，启动Container之前将需要的程序及其依赖包、配置文件等拷贝到本地）</p>
<h3 id="内部结构-1"><a href="#内部结构-1" class="headerlink" title="内部结构"></a>内部结构</h3><p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1gruofr52ipj30kw0f0qbs.jpg" alt="捕获.PNG"></p>
<ul>
<li><p>NodeStatusUpdater: 启动向ResourceManager注册，报告该节点的可用资源情况，通信的端口和后续状态的维护</p>
</li>
<li><p>ContainerManager: 接收RPC请求（启动、停止），资源本地化（下载应用需要的资源到本地，根据需要共享这些资源）</p>
</li>
</ul>
<p>PUBLIC: &#x2F;filecache</p>
<p>PRIVATE: &#x2F;usercache&#x2F;&#x2F;filecache</p>
<p>APPLICATION: &#x2F;usercache&#x2F;&#x2F;appcache&#x2F;&#x2F;（在程序完成后会被删除）</p>
<ul>
<li>ContainersLauncher: 加载或终止Container</li>
<li>ContainerMonitor: 监控Container的运行和资源使用情况</li>
<li>ContainerExecutor: 和底层操作系统交互，加载要运行的程序</li>
</ul>
<h2 id="ApplicationMaster-单个作业的资源管理和任务监控"><a href="#ApplicationMaster-单个作业的资源管理和任务监控" class="headerlink" title="ApplicationMaster: 单个作业的资源管理和任务监控"></a>ApplicationMaster: 单个作业的资源管理和任务监控</h2><p>具体功能描述：</p>
<ul>
<li>计算应用的资源需求，资源可以是静态或动态计算的，静态的一般是Client申请时就指定了，动态则需要ApplicationMaster根据应用的运行状态来决定</li>
<li>根据数据来申请对应位置的资源（Data Locality）</li>
<li>向ResourceManager申请资源，与NodeManager交互进行程序的运行和监控，监控申请的资源的使用情况，监控作业进度</li>
<li>跟踪任务状态和进度，定时向ResourceManager发送心跳消息，报告资源的使用情况和应用的进度信息</li>
<li>负责本作业内的任务的容错</li>
</ul>
<p>ApplicationMaster可以是用任何语言编写的程序，它和ResourceManager和NodeManager之间是通过ProtocolBuf交互，以前是一个全局的JobTracker负责的，现在每个作业都一个，可伸缩性更强，至少不会因为作业太多，造成JobTracker瓶颈。同时将作业的逻辑放到一个独立的ApplicationMaster中，使得灵活性更加高，每个作业都可以有自己的处理方式，不用绑定到MapReduce的处理模式上</p>
<h3 id="如何计算资源需求"><a href="#如何计算资源需求" class="headerlink" title="如何计算资源需求"></a>如何计算资源需求</h3><p>一般的MapReduce是根据block数量来定Map和Reduce的计算数量，然后一般的Map或Reduce就占用一个Container</p>
<h3 id="如何发现数据的本地化"><a href="#如何发现数据的本地化" class="headerlink" title="如何发现数据的本地化"></a>如何发现数据的本地化</h3><p>数据本地化是通过HDFS的block分片信息获取的</p>
<h2 id="Container-资源申请的单位和任务运行的容器"><a href="#Container-资源申请的单位和任务运行的容器" class="headerlink" title="Container: 资源申请的单位和任务运行的容器"></a>Container: 资源申请的单位和任务运行的容器</h2><ul>
<li>基本的资源单位（CPU、内存等）</li>
<li>Container可以加载任意程序，而且不限于Java</li>
<li>一个Node可以包含多个Container，也可以是一个大的Container</li>
<li>ApplicationMaster可以根据需要，动态申请和释放Container</li>
</ul>
<h2 id="YARN基本流程"><a href="#YARN基本流程" class="headerlink" title="YARN基本流程"></a>YARN基本流程</h2><p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1grunu6spixj30f70e4tbz.jpg" alt="捕获.PNG"></p>
<ol>
<li>Job submission</li>
</ol>
<p>从ResourceManager 中获取一个Application ID 检查作业输出配置，计算输入分片 拷贝作业资源（job jar、配置文件、分片信息）到 HDFS，以便后面任务的执行</p>
<ol start="2">
<li>Job initialization</li>
</ol>
<p>ResourceManager 将作业递交给 Scheduler（有很多调度算法，一般是根据优先级）Scheduler 为作业分配一个 Container，ResourceManager 就加载一个 application master process 并交给 NodeManager。</p>
<p>管理 ApplicationMaster 主要是创建一系列的监控进程来跟踪作业的进度，同时获取输入分片，为每一个分片创建一个 Map task 和相应的 reduce task Application Master 还决定如何运行作业，如果作业很小（可配置），则直接在同一个 JVM 下运行</p>
<ol start="3">
<li>Task assignment</li>
</ol>
<p>ApplicationMaster 向 Resource Manager 申请资源（一个个的Container，指定任务分配的资源要求）一般是根据 data locality 来分配资源</p>
<ol start="4">
<li>Task execution</li>
</ol>
<p>ApplicationMaster 根据 ResourceManager 的分配情况，在对应的 NodeManager 中启动 Container 从 HDFS 中读取任务所需资源（job jar，配置文件等），然后执行该任务</p>
<p><img src="http://ww1.sinaimg.cn/large/006eDJDNly1grunuxvflij30er0d9mzi.jpg" alt="捕获.PNG"></p>
<ol start="5">
<li>Progress and status update</li>
</ol>
<p>定时将任务的进度和状态报告给 ApplicationMaster Client 定时向 ApplicationMaster 获取整个任务的进度和状态</p>
<ol start="6">
<li>Job completion</li>
</ol>
<p>Client定时检查整个作业是否完成 作业完成后，会清空临时文件、目录等</p>
<h1 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h1>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/08/python%E5%B0%86word%E8%BD%AC%E6%8D%A2%E4%B8%BApdf/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/01/08/python%E5%B0%86word%E8%BD%AC%E6%8D%A2%E4%B8%BApdf/" class="post-title-link" itemprop="url">python将word转换为pdf</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-01-08 09:34:27" itemprop="dateCreated datePublished" datetime="2021-01-08T09:34:27+08:00">2021-01-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/01/08/python%E5%B0%86word%E8%BD%AC%E6%8D%A2%E4%B8%BApdf/" class="leancloud_visitors" data-flag-title="python将word转换为pdf">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<p>代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> Dispatch</span><br><span class="line"> </span><br><span class="line">word = Dispatch(<span class="string">&#x27;Word.Application&#x27;</span>)</span><br><span class="line">doc = word.Documents.Open(<span class="string">&quot;J:\\新建文件夹 (3)\\调休报告书20200706.doc&quot;</span>)</span><br><span class="line">doc.SaveAs(<span class="string">&quot;J:\\新建文件夹 (3)\\调休报告书20200706.pdf&quot;</span>, FileFormat=<span class="number">17</span>)</span><br><span class="line">doc.Close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>封装后的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> Dispatch</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> walk</span><br><span class="line"> </span><br><span class="line">wdFormatPDF = <span class="number">17</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doc2pdf</span>(<span class="params">input_file</span>):</span><br><span class="line">    word = Dispatch(<span class="string">&#x27;Word.Application&#x27;</span>)</span><br><span class="line">    doc = word.Documents.Open(input_file)</span><br><span class="line">    doc.SaveAs(input_file.replace(<span class="string">&quot;.docx&quot;</span>, <span class="string">&quot;.pdf&quot;</span>), FileFormat=wdFormatPDF)</span><br><span class="line">    doc.Close()</span><br><span class="line">    word.Quit()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    doc_files = []</span><br><span class="line">    directory = <span class="string">&quot;C:\\Users\\xkw\\Desktop\\destData&quot;</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, filenames <span class="keyword">in</span> walk(directory):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> filenames:</span><br><span class="line">            <span class="keyword">if</span> file.endswith(<span class="string">&quot;.doc&quot;</span>) <span class="keyword">or</span> file.endswith(<span class="string">&quot;.docx&quot;</span>):</span><br><span class="line">                doc2pdf(<span class="built_in">str</span>(root + <span class="string">&quot;\\&quot;</span> + file))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/08/python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E9%99%84%E4%BB%B6%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/01/08/python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E9%99%84%E4%BB%B6%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">python发送邮件附件中文乱码问题</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-01-08 08:56:48" itemprop="dateCreated datePublished" datetime="2021-01-08T08:56:48+08:00">2021-01-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2021/01/08/python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E9%99%84%E4%BB%B6%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/" class="leancloud_visitors" data-flag-title="python发送邮件附件中文乱码问题">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<p>在用python发邮件时，使用的是如下代码：</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-email.html">https://www.runoob.com/python/python-email.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"> </span><br><span class="line">sender = <span class="string">&#x27;from@runoob.com&#x27;</span></span><br><span class="line">receivers = [<span class="string">&#x27;429240967@qq.com&#x27;</span>]  <span class="comment"># 接收邮件，可设置为你的QQ邮箱或者其他邮箱</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#创建一个带附件的实例</span></span><br><span class="line">message = MIMEMultipart()</span><br><span class="line">message[<span class="string">&#x27;From&#x27;</span>] = Header(<span class="string">&quot;菜鸟教程&quot;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">message[<span class="string">&#x27;To&#x27;</span>] =  Header(<span class="string">&quot;测试&quot;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">subject = <span class="string">&#x27;Python SMTP 邮件测试&#x27;</span></span><br><span class="line">message[<span class="string">&#x27;Subject&#x27;</span>] = Header(subject, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#邮件正文内容</span></span><br><span class="line">message.attach(MIMEText(<span class="string">&#x27;这是菜鸟教程Python 邮件发送测试……&#x27;</span>, <span class="string">&#x27;plain&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 构造附件1，传送当前目录下的 test.txt 文件</span></span><br><span class="line">att1 = MIMEText(<span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">att1[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line"><span class="comment"># 这里的filename可以任意写，写什么名字，邮件中显示什么名字</span></span><br><span class="line">att1[<span class="string">&quot;Content-Disposition&quot;</span>] = <span class="string">&#x27;attachment; filename=&quot;test.txt&quot;&#x27;</span></span><br><span class="line">message.attach(att1)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 构造附件2，传送当前目录下的 runoob.txt 文件</span></span><br><span class="line">att2 = MIMEText(<span class="built_in">open</span>(<span class="string">&#x27;runoob.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">att2[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">att2[<span class="string">&quot;Content-Disposition&quot;</span>] = <span class="string">&#x27;attachment; filename=&quot;runoob.txt&quot;&#x27;</span></span><br><span class="line">message.attach(att2)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    smtpObj = smtplib.SMTP(<span class="string">&#x27;localhost&#x27;</span>)</span><br><span class="line">    smtpObj.sendmail(sender, receivers, message.as_string())</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;邮件发送成功&quot;</span></span><br><span class="line"><span class="keyword">except</span> smtplib.SMTPException:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Error: 无法发送邮件&quot;</span></span><br></pre></td></tr></table></figure>

<p>但是，添加附件的时候，出现了附件无法附上的问题，甚至发往QQ邮箱，会出现<code>TCMIME322</code>类似的附件名称，后查阅资料，发现是中文乱码问题，如果附件设置成英文的话，则不存在这个问题</p>
<p>这是上面的代码，在<code>filename=&quot;test.txt&quot;</code>这里，如果是中文的话，会出现附件附不上，出现乱码问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">att1 = MIMEText(<span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">att1[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line"><span class="comment"># 这里的filename可以任意写，写什么名字，邮件中显示什么名字</span></span><br><span class="line">att1[<span class="string">&quot;Content-Disposition&quot;</span>] = <span class="string">&#x27;attachment; filename=&quot;test.txt&quot;&#x27;</span></span><br><span class="line">message.attach(att1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">fileName = <span class="string">&quot;汇总月报.pdf&quot;</span></span><br><span class="line"><span class="comment"># 用base64对文件名进行编码（b64的参数必须是字节类型，所以要先对文件名进行编码）</span></span><br><span class="line">bs_fileName = base64.b64encode(fileName.encode(<span class="string">&#x27;UTF-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># bs_filename是字节类型数据，不能直接和字符串相连，所以要必须要decode。</span></span><br><span class="line">att1.add_header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">&#x27;attachment&#x27;</span>, filename= <span class="string">&#x27;=?utf-8?b?&#x27;</span> + bs_fileName.decode() + <span class="string">&#x27;?=&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="base64学习"><a href="#base64学习" class="headerlink" title="base64学习"></a>base64学习</h1><p>Email在网络上传输时，采用MIME(Multipurpose Internet Mail Extensions)。邮件传输只能传送US-ASCII字符，邮件中包含的其他字符必须通过一定的编码转换之后才能传输。对于Subject或&#x2F;和附件名称为中文字符的邮件，有些邮件系统因为缺少编码（字符编码和传输编码）信息，导致乱码情况的发生。下面分析Email系统的两种编码——Base64和Quoted-Printable。</p>
<p>首先需要分清楚字符编码和传输编码：</p>
<ul>
<li>字符编码：UTF-8，GB2312</li>
<li>传输编码：Base64，Quoted-Printable</li>
</ul>
<h2 id="Email-Subject和附件名的表达格式"><a href="#Email-Subject和附件名的表达格式" class="headerlink" title="Email Subject和附件名的表达格式"></a>Email Subject和附件名的表达格式</h2><p>有了Base64和Quoted-Printable的编码方式，要有一定的格式指示采用的哪种传输编码，同时还要指定编码的字符所采用的字符编码方式。</p>
<p>Email的Subject和附件名的表达格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;prefix&gt;&lt;charset&gt;?&lt;encodeMode&gt;?&lt;encodedContent&gt;&lt;suffix&gt;</span><br></pre></td></tr></table></figure>

<p>其中，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;prefix&gt;             固定为“=?”；</span><br><span class="line">&lt;charset&gt;            为字符编码格式；</span><br><span class="line">&lt;encodeMode&gt;         为传输编码格式：B代表Base64；Q代表Quote-Printable</span><br><span class="line">&lt;encodedContent&gt;     为用encodeMode 编码过的字符编码为charset的字符串</span><br><span class="line">&lt;suffix&gt;             固定为“?=”</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所以，这就能解释上面的这一串了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;prefix&gt;&lt;charset&gt;?&lt;encodeMode&gt;?     &lt;encodedContent&gt;      &lt;suffix&gt;</span><br><span class="line">  &#x27;=?     utf-8  ?     b      ?&#x27; + bs_fileName.decode() +   &#x27;?=&#x27;</span><br></pre></td></tr></table></figure>





<h1 id="参考文献："><a href="#参考文献：" class="headerlink" title="参考文献："></a>参考文献：</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/thl789/article/details/7815866">https://blog.csdn.net/thl789/article/details/7815866</a></p>
<p><a target="_blank" rel="noopener" href="https://www.douban.com/group/topic/40848076/">https://www.douban.com/group/topic/40848076/</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/04/python-%E5%8A%9E%E5%85%AC%E8%87%AA%E5%8A%A8%E5%8C%96/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/01/04/python-%E5%8A%9E%E5%85%AC%E8%87%AA%E5%8A%A8%E5%8C%96/" class="post-title-link" itemprop="url">python-办公自动化</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-01-04 10:04:28" itemprop="dateCreated datePublished" datetime="2021-01-04T10:04:28+08:00">2021-01-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2021/01/04/python-%E5%8A%9E%E5%85%AC%E8%87%AA%E5%8A%A8%E5%8C%96/" class="leancloud_visitors" data-flag-title="python-办公自动化">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="工作簿"><a href="#工作簿" class="headerlink" title="工作簿"></a>工作簿</h1><h2 id="创建工作簿"><a href="#创建工作簿" class="headerlink" title="创建工作簿"></a>创建工作簿</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建工作簿</span></span><br><span class="line">wb = Workbook()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作簿的属性</span></span><br><span class="line"><span class="comment"># properties</span></span><br><span class="line">wb.properties.title =<span class="string">&#x27;标题 动物世界&#x27;</span></span><br><span class="line">wb.properties.subject = <span class="string">&#x27;主题 保护动物&#x27;</span></span><br><span class="line">wb.properties.category = <span class="string">&#x27;类别&#x27;</span></span><br><span class="line">wb.properties.keywords =<span class="string">&#x27;濒危&#x27;</span></span><br><span class="line">wb.properties.creator = <span class="string">&#x27;LCF&#x27;</span></span><br><span class="line">wb.properties.description = <span class="string">&quot;备注信息&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存工作簿</span></span><br><span class="line">wb.save(<span class="string">&#x27;06workbook.xlsx&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="创建工作表-worksheet"><a href="#创建工作表-worksheet" class="headerlink" title="创建工作表-worksheet"></a>创建工作表-worksheet</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook, load_workbook</span><br><span class="line"><span class="comment"># 2.实例化-创建工作簿</span></span><br><span class="line">wb = Workbook()</span><br><span class="line"><span class="comment">############################1.创建工作表########################</span></span><br><span class="line">sheet1 = wb.create_sheet(<span class="string">&#x27;学生表&#x27;</span>, index=<span class="number">0</span>)</span><br><span class="line">sheet2 = wb.create_sheet(<span class="string">&#x27;得分表&#x27;</span>)</span><br><span class="line"><span class="comment">############################2.获取工作表对象和名称########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.获取所有表</span></span><br><span class="line">sheets = wb.get_sheet_names()</span><br><span class="line">sheets = wb.sheetnames</span><br><span class="line"><span class="comment"># 2.获取默认的表</span></span><br><span class="line">active_sheet = wb.active</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.根据表名字获取表</span></span><br><span class="line"> name_sheet = wb.get_sheet_by_name(<span class="string">&#x27;得分表&#x27;</span>)</span><br><span class="line">name_sheet = wb[<span class="string">&#x27;得分表&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################3.更改工作表的名称并设置背景颜色########################</span></span><br><span class="line"></span><br><span class="line">active_sheet.title = <span class="string">&quot;学科表&quot;</span> <span class="comment"># 修改名字</span></span><br><span class="line"><span class="comment"># 颜色 是需要写16进制</span></span><br><span class="line">active_sheet.sheet_properties.tabColor = <span class="string">&#x27;F00906&#x27;</span></span><br><span class="line"><span class="comment"># 颜色 三种表示  方式</span></span><br><span class="line"><span class="comment"># 三原色 红     绿   蓝</span></span><br><span class="line"><span class="comment">#       red green blue</span></span><br><span class="line"><span class="comment">#      0-255 0-255 0-255</span></span><br><span class="line"><span class="comment"># 1.单词 red  green pink blue</span></span><br><span class="line"><span class="comment"># 2.rgb  255 0 0</span></span><br><span class="line"><span class="comment"># 3.16 hex : &#x27;FF0000&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################4.获取工作表的行数和列数########################</span></span><br><span class="line">wb = load_workbook(<span class="string">&#x27;07sheet.xlsx&#x27;</span>) <span class="comment">#加载 存在的工作簿</span></span><br><span class="line">active_sheet = wb.active</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;行数:&#x27;</span>, active_sheet.max_row)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;列数:&#x27;</span>, active_sheet.max_column)</span><br><span class="line"><span class="comment"># 默认 空表 行数列数 都是 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################5.复制工作表########################</span></span><br><span class="line">copy_sheet = wb.copy_worksheet(active_sheet)</span><br><span class="line">copy_sheet.title = <span class="string">&#x27;克隆表&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################6.删除工作表########################</span></span><br><span class="line"><span class="comment"># 删除工作表</span></span><br><span class="line">wb.remove(copy_sheet)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="sheet-cell操作"><a href="#sheet-cell操作" class="headerlink" title="sheet-cell操作"></a>sheet-cell操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.cell <span class="keyword">import</span> Cell</span><br><span class="line"><span class="keyword">from</span> openpyxl.comments <span class="keyword">import</span> Comment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 实例化  --建立工作簿</span></span><br><span class="line">wb = Workbook()</span><br><span class="line">sheet = wb.active <span class="comment"># 默认表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################1.写入数据########################</span></span><br><span class="line">sheet[<span class="string">&#x27;A1&#x27;</span>] = <span class="string">&#x27;itcast&#x27;</span></span><br><span class="line">sheet[<span class="string">&#x27;a2&#x27;</span>] = <span class="string">&#x27;HEI&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################2.写入公式########################</span></span><br><span class="line">sheet[<span class="string">&#x27;E1&#x27;</span>] = <span class="number">30</span></span><br><span class="line">sheet[<span class="string">&#x27;E2&#x27;</span>] = <span class="number">1</span></span><br><span class="line">sheet[<span class="string">&#x27;E3&#x27;</span>] = <span class="string">&quot;=$E1+$E2&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################3.写入超链接########################</span></span><br><span class="line"><span class="comment"># 外面的链接</span></span><br><span class="line">sheet[<span class="string">&#x27;B2&#x27;</span>] = <span class="string">&quot;传智播客&quot;</span></span><br><span class="line"><span class="comment"># 如果 python中的变量 没有提示了</span></span><br><span class="line"><span class="comment"># 你可以主动标注 这个变量的类型 就有提示</span></span><br><span class="line">cell:Cell = sheet[<span class="string">&#x27;B2&#x27;</span>]</span><br><span class="line">cell.hyperlink = <span class="string">&#x27;http://www.itcast.cn&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 内部链接</span></span><br><span class="line">new_sheet = wb.create_sheet(<span class="string">&#x27;STU_SHEET&#x27;</span>)</span><br><span class="line">new_sheet[<span class="string">&#x27;A3&#x27;</span>] = <span class="string">&#x27;张朝阳&#x27;</span></span><br><span class="line">sheet[<span class="string">&#x27;B3&#x27;</span>] = <span class="string">&#x27;内部链接&#x27;</span></span><br><span class="line">cell:Cell = sheet[<span class="string">&#x27;B3&#x27;</span>]</span><br><span class="line">cell.hyperlink = <span class="string">&#x27;08cell.xlsx#STU_SHEET!A3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################4写入批注########################</span></span><br><span class="line">sheet[<span class="string">&#x27;E6&#x27;</span>] = <span class="string">&quot;李彦宏&quot;</span></span><br><span class="line">cell6:Cell = sheet[<span class="string">&#x27;E6&#x27;</span>]</span><br><span class="line">cell6.comment = Comment(<span class="string">&#x27;绰号:肉饼,RobiLi&#x27;</span>, <span class="string">&#x27;LCF&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"></span><br><span class="line">wb = Workbook()</span><br><span class="line">sheet = wb.active</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################1按行写入数据##########################</span></span><br><span class="line">sheet.cell(row=<span class="number">2</span>, column=<span class="number">3</span>, value=<span class="number">6666</span>)</span><br><span class="line">data = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">    sheet.cell(row=<span class="number">5</span>, column=index + <span class="number">1</span>, value=val)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################2 按列写入数据########################</span></span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">    sheet.cell(row=i + <span class="number">1</span>, column=<span class="number">8</span>, value=v)</span><br><span class="line"></span><br><span class="line"><span class="comment">#########################3 追加写入行数据###########################</span></span><br><span class="line"></span><br><span class="line">sheet.append([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################3.批量写入数据##########################</span></span><br><span class="line"><span class="comment"># 遍历 表中的指定范围的 行数列数</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> sheet[<span class="string">&#x27;A10:C14&#x27;</span>]:</span><br><span class="line">    <span class="comment"># 遍历 每行的  单元格 cell</span></span><br><span class="line">    <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">        <span class="comment"># 给给每个单元格 赋值</span></span><br><span class="line">        cell.value = <span class="string">&#x27;HEIMA&#x27;</span></span><br><span class="line"><span class="comment">##########################4.修改单元格的值##########################</span></span><br><span class="line">sheet[<span class="string">&#x27;B12&#x27;</span>] = <span class="string">&#x27;新的值新的值新的值新的值新的值&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################1.合并单元格########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.矩形合并 范围</span></span><br><span class="line">sheet.merge_cells(<span class="string">&#x27;L2:M4&#x27;</span>)</span><br><span class="line"><span class="comment"># 2.行合并  数字不变  字母变</span></span><br><span class="line">sheet.merge_cells(<span class="string">&#x27;A5:F5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.列合并  字母不变 数字变</span></span><br><span class="line">sheet.merge_cells(<span class="string">&#x27;H1:H4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################2.拆分单元格########################</span></span><br><span class="line">sheet.unmerge_cells(<span class="string">&#x27;L2:M4&#x27;</span>)</span><br><span class="line">sheet.unmerge_cells(<span class="string">&#x27;A5:F5&#x27;</span>)</span><br><span class="line">sheet.unmerge_cells(<span class="string">&#x27;H1:H4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################3.移动单元格########################</span></span><br><span class="line">sheet.move_range(<span class="string">&#x27;B7&#x27;</span>, rows=<span class="number">1</span>, cols=<span class="number">3</span>)</span><br><span class="line">sheet.move_range(<span class="string">&#x27;B7&#x27;</span>, rows=-<span class="number">1</span>, cols=<span class="number">3</span>)</span><br><span class="line">sheet.move_range(<span class="string">&#x27;B7&#x27;</span>, rows=<span class="number">0</span>, cols=<span class="number">3</span>)</span><br><span class="line">sheet.move_range(<span class="string">&#x27;B7&#x27;</span>, rows=<span class="number">1</span>, cols=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################4.插入行##########################</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    sheet.cell(row=(i+<span class="number">1</span>),column=<span class="number">2</span>,value=i)</span><br><span class="line"></span><br><span class="line">sheet.insert_rows(<span class="number">12</span>, amount=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################5.插入列########################</span></span><br><span class="line"></span><br><span class="line">sheet.insert_cols(<span class="number">4</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.cell <span class="keyword">import</span> Cell</span><br><span class="line"></span><br><span class="line">wb = Workbook()</span><br><span class="line">sheet = wb.active</span><br><span class="line"></span><br><span class="line"><span class="comment">############################1.单元格的宽和高########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一行的  高度 80磅</span></span><br><span class="line">sheet.row_dimensions[<span class="number">1</span>].height = <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三列的  宽度 100磅</span></span><br><span class="line">sheet.column_dimensions[<span class="string">&#x27;C&#x27;</span>].width = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################2.单元格内字体、字号等信息########################</span></span><br><span class="line">cell: Cell = sheet[<span class="string">&#x27;C5&#x27;</span>]</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Font</span><br><span class="line"></span><br><span class="line">cell.font = Font(</span><br><span class="line">    name=<span class="string">&quot;楷体&quot;</span>,  <span class="comment"># 字体</span></span><br><span class="line">    color=<span class="string">&quot;00FF00&quot;</span>,  <span class="comment"># 字体颜色,</span></span><br><span class="line">    size=<span class="number">40</span>,  <span class="comment"># 字体大小</span></span><br><span class="line">    bold=<span class="literal">False</span>,  <span class="comment"># 是否加粗</span></span><br><span class="line">    underline=<span class="string">&#x27;single&#x27;</span>,  <span class="comment"># 下划线</span></span><br><span class="line">    strike=<span class="literal">True</span>,  <span class="comment"># 删除线</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#########################3..换行、单元格内对齐方式###########################</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Alignment</span><br><span class="line"></span><br><span class="line">cell.alignment = Alignment(</span><br><span class="line">    wrap_text=<span class="literal">True</span>,  <span class="comment"># 文字特别多的时候 是否 换行</span></span><br><span class="line">    horizontal=<span class="string">&#x27;left&#x27;</span>,  <span class="comment"># 水平居中</span></span><br><span class="line">    vertical=<span class="string">&#x27;bottom&#x27;</span>,  <span class="comment"># 垂直 居中 top  center bottom</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################4.单元格颜色##########################</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> PatternFill</span><br><span class="line"></span><br><span class="line">cell.fill = PatternFill(</span><br><span class="line">    fill_type=<span class="string">&#x27;solid&#x27;</span>,</span><br><span class="line">    fgColor=<span class="string">&#x27;FF0000&#x27;</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################5.边框线的形式和颜色########################</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Border, Side</span><br><span class="line"></span><br><span class="line">cell.border = Border(</span><br><span class="line">    left=Side(border_style=<span class="string">&#x27;dashed&#x27;</span>, color=<span class="string">&#x27;00F000&#x27;</span>),</span><br><span class="line">    right=Side(border_style=<span class="string">&#x27;thick&#x27;</span>, color=<span class="string">&#x27;FFF000&#x27;</span>),</span><br><span class="line">    top=Side(border_style=<span class="string">&#x27;double&#x27;</span>, color=<span class="string">&#x27;0FF0FF&#x27;</span>),</span><br><span class="line">    bottom=Side(border_style=<span class="string">&#x27;dotted&#x27;</span>, color=<span class="string">&#x27;00FFFF&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl.drawing.image <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment">#          图片的路径 : 相对路径 绝对路径</span></span><br><span class="line">img = Image(<span class="string">&#x27;0.png&#x27;</span>)</span><br><span class="line">img.width = img.width * <span class="number">0.5</span></span><br><span class="line">img.height = img.height * <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.指定表中 图片的位置</span></span><br><span class="line">img.anchor = <span class="string">&#x27;C5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.插入图片</span></span><br><span class="line">sheet.add_image(img)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包 加载模块</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook, Workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.cell <span class="keyword">import</span> Cell</span><br><span class="line"></span><br><span class="line">wb = load_workbook(<span class="string">&#x27;05-read_cell_data.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.获取表</span></span><br><span class="line">sheet = wb.worksheets[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(sheet.title)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.获取单元格 --取值</span></span><br><span class="line">cell:Cell = sheet[<span class="string">&#x27;C2&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;单元格的数据:&#x27;</span>, cell.value)</span><br><span class="line"></span><br><span class="line"><span class="comment">###########################安行获取数据########################</span></span><br><span class="line">row = sheet[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">    <span class="built_in">print</span>(cell.value)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################按列获取数据########################</span></span><br><span class="line">col = sheet[<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> cell <span class="keyword">in</span> col:</span><br><span class="line">    <span class="built_in">print</span>(cell.value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 注解 批注 ----为了测试 获取批注</span></span><br><span class="line">new_wb = Workbook()</span><br><span class="line">new_ws = new_wb.active</span><br><span class="line">new_ws[<span class="string">&#x27;A1&#x27;</span>] = <span class="string">&#x27;获取注解&#x27;</span></span><br><span class="line"></span><br><span class="line">sheet[<span class="string">&#x27;A1&#x27;</span>].comment</span><br><span class="line">sheet[<span class="string">&#x27;A1&#x27;</span>].comment.content</span><br><span class="line">sheet[<span class="string">&#x27;A1&#x27;</span>].comment.author</span><br><span class="line"></span><br><span class="line"><span class="comment">############################读取属性########################</span></span><br><span class="line"></span><br><span class="line">style_wb = load_workbook(<span class="string">&#x27;03celluse.xlsx&#x27;</span>)</span><br><span class="line">sheet = style_wb.worksheets[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">cell:Cell = sheet[<span class="string">&#x27;C5&#x27;</span>]</span><br><span class="line"><span class="comment"># 字体</span></span><br><span class="line">cell.font.name</span><br><span class="line"><span class="comment"># 字体大小</span></span><br><span class="line">cell.font.size</span><br><span class="line"><span class="comment"># 字体颜色</span></span><br><span class="line">cell.font.color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cell.font.bold <span class="comment"># 是否加粗</span></span><br><span class="line">cell.font.underline <span class="comment"># 有无下划线</span></span><br><span class="line">cell.font.italic <span class="comment"># 是否斜体</span></span><br><span class="line">cell.font.strike <span class="comment"># 有无删除线</span></span><br><span class="line"></span><br><span class="line">row = cell.row</span><br><span class="line">col = cell.column</span><br><span class="line"><span class="comment"># print(&#x27;当前值的所在行是第&#123;&#125;行&#x27;.format(row))</span></span><br><span class="line"><span class="comment"># print(&#x27;当前值的所在列是第&#123;&#125;列&#x27;.format(col))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据列号  取出 列名字</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.utils <span class="keyword">import</span> get_column_letter</span><br><span class="line">col_name = get_column_letter(col)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;列名:&#x27;</span>, col_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据列名字 取出  列号</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.utils <span class="keyword">import</span> column_index_from_string</span><br><span class="line">col_index = column_index_from_string(col_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;列号:&#x27;</span>, col_index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cell.alignment.wrap_text <span class="comment"># 是否自动换行</span></span><br><span class="line">cell.alignment.horizontal <span class="comment"># 垂直对齐方式</span></span><br><span class="line">cell.alignment.vertical <span class="comment"># 水平对齐方式​</span></span><br><span class="line">cell.fill.fgColor <span class="comment"># 单元格背景颜色</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单元格边线的样式和颜色</span></span><br><span class="line">cell.border.left.style</span><br><span class="line">cell.border.left.color</span><br><span class="line">cell.border.right.color</span><br><span class="line">cell.border.top.color</span><br><span class="line">cell.border.bottom.color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="图模块"><a href="#图模块" class="headerlink" title="图模块"></a>图模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1.到模块 工作簿  ---- 图的模块</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> LineChart, Reference</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.建簿 建表</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.chart.axis <span class="keyword">import</span> DateAxis</span><br><span class="line"></span><br><span class="line">wb = Workbook()</span><br><span class="line">sheet = wb.active</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据</span></span><br><span class="line">rows = [</span><br><span class="line">    [<span class="string">&#x27;日期&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">    [date(<span class="number">2015</span>,<span class="number">9</span>, <span class="number">1</span>), <span class="number">40</span>, <span class="number">30</span>, <span class="number">25</span>],</span><br><span class="line">    [date(<span class="number">2015</span>,<span class="number">9</span>, <span class="number">2</span>), <span class="number">40</span>, <span class="number">25</span>, <span class="number">30</span>],</span><br><span class="line">    [date(<span class="number">2015</span>,<span class="number">9</span>, <span class="number">3</span>), <span class="number">50</span>, <span class="number">30</span>, <span class="number">45</span>],</span><br><span class="line">    [date(<span class="number">2015</span>,<span class="number">9</span>, <span class="number">4</span>), <span class="number">30</span>, <span class="number">25</span>, <span class="number">40</span>],</span><br><span class="line">    [date(<span class="number">2015</span>,<span class="number">9</span>, <span class="number">5</span>), <span class="number">25</span>, <span class="number">35</span>, <span class="number">30</span>],</span><br><span class="line">    [date(<span class="number">2015</span>,<span class="number">9</span>, <span class="number">6</span>), <span class="number">20</span>, <span class="number">40</span>, <span class="number">35</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">    sheet.append(row)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.创建折线图 设置属性</span></span><br><span class="line">c1 = LineChart()</span><br><span class="line">c1.title = <span class="string">&#x27;销售业绩表&#x27;</span></span><br><span class="line">c1.style = <span class="number">13</span></span><br><span class="line">c1.x_axis.title = <span class="string">&#x27;销售日期&#x27;</span></span><br><span class="line">c1.y_axis.title = <span class="string">&#x27;百万&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 设置 折线图的数据</span></span><br><span class="line"><span class="comment"># 选择折线图的数据，min_col,min_row,max_row,max_col</span></span><br><span class="line">data = Reference(sheet, min_col=<span class="number">2</span>, min_row=<span class="number">1</span>,max_row=<span class="number">7</span>, max_col=<span class="number">4</span>)</span><br><span class="line">c1.add_data(data, titles_from_data=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">############################ 设置日期单位########################</span></span><br><span class="line"><span class="comment"># c1.x_axis = DateAxis(crossAx=100)</span></span><br><span class="line">c1.x_axis.number_format = <span class="string">&#x27;yyyy-mm-d&#x27;</span></span><br><span class="line">c1.x_axis.majorTimeUnit = <span class="string">&quot;days&quot;</span></span><br><span class="line"><span class="comment"># 设置  X 轴上面 显示日期</span></span><br><span class="line">dates = Reference(sheet, min_col=<span class="number">1</span>, min_row=<span class="number">2</span>, max_row=<span class="number">6</span>)</span><br><span class="line">c1.set_categories(dates)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置第一条折线图的样式</span></span><br><span class="line">s1 = c1.series[<span class="number">0</span>]</span><br><span class="line">s1.marker.symbol = <span class="string">&quot;triangle&quot;</span> <span class="comment">#marker的样式</span></span><br><span class="line">s1.marker.graphicalProperties.solidFill = <span class="string">&quot;FF0000&quot;</span> <span class="comment"># marker填充颜色</span></span><br><span class="line">s1.marker.graphicalProperties.line.solidFill = <span class="string">&quot;FF0000&quot;</span> <span class="comment"># marker线颜色</span></span><br><span class="line">s1.graphicalProperties.line.noFill = <span class="literal">True</span>  <span class="comment">#是否填充连接线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置第二条折线图的样式</span></span><br><span class="line">s2 = c1.series[<span class="number">1</span>]</span><br><span class="line">s2.graphicalProperties.line.solidFill = <span class="string">&quot;00AAAA&quot;</span></span><br><span class="line">s2.graphicalProperties.line.dashStyle = <span class="string">&quot;sysDot&quot;</span>  <span class="comment">#破折号样式</span></span><br><span class="line">s2.graphicalProperties.line.width = <span class="number">100050</span> <span class="comment">#宽度</span></span><br><span class="line"><span class="comment">#设置第三条折线图的样式</span></span><br><span class="line">s2 = c1.series[<span class="number">2</span>]</span><br><span class="line">s2.smooth = <span class="literal">True</span> <span class="comment">#是否让折现平滑</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.添加到表中</span></span><br><span class="line">sheet.add_chart(c1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> PieChart, Reference</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.实例化</span></span><br><span class="line">wb = Workbook()</span><br><span class="line">sheet = wb.active</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.准备饼状图的数据</span></span><br><span class="line">data = [</span><br><span class="line">    [<span class="string">&#x27;类&#x27;</span>, <span class="string">&#x27;销量&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;苹果&#x27;</span>, <span class="number">50</span>],</span><br><span class="line">    [<span class="string">&#x27;樱桃&#x27;</span>, <span class="number">30</span>],</span><br><span class="line">    [<span class="string">&#x27;南瓜&#x27;</span>, <span class="number">10</span>],</span><br><span class="line">    [<span class="string">&#x27;巧克力&#x27;</span>, <span class="number">40</span>],</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> data:</span><br><span class="line">    sheet.append(v)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.创建饼状图</span></span><br><span class="line">p1 = PieChart()</span><br><span class="line">p1.title = <span class="string">&#x27;水果销量表&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加  数据 --饼状图</span></span><br><span class="line"></span><br><span class="line">data = Reference(sheet, min_row=<span class="number">1</span>, min_col=<span class="number">2</span>, max_row=<span class="number">5</span>)</span><br><span class="line">p1.add_data(data, titles_from_data=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 右侧 标注</span></span><br><span class="line">lables = Reference(sheet, min_row=<span class="number">2</span>, min_col=<span class="number">1</span>, max_row=<span class="number">5</span>)</span><br><span class="line">p1.set_categories(lables)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置饼状图的样式</span></span><br><span class="line"><span class="comment"># 1.导入模块 datapoint</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.chart.series <span class="keyword">import</span> DataPoint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.设置   哪个饼子 分离多远的点位</span></span><br><span class="line"><span class="comment"># idx 决定 到底是哪个类 分离</span></span><br><span class="line"><span class="comment"># explosion 决定了 离圆心的距离</span></span><br><span class="line"><span class="built_in">slice</span> = DataPoint(idx=<span class="number">2</span>, explosion=<span class="number">50</span>)</span><br><span class="line"><span class="comment"># 3.设置位置</span></span><br><span class="line">p1.series[<span class="number">0</span>].data_points = [<span class="built_in">slice</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将饼状图  写入 sheet</span></span><br><span class="line">sheet.add_chart(p1,<span class="string">&#x27;D1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="合并excel"><a href="#合并excel" class="headerlink" title="合并excel"></a>合并excel</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook, load_workbook</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 获取 目标目录 --下面的 所有 excel文件</span></span><br><span class="line">current_dir_path = os.getcwd()</span><br><span class="line">excel_files = os.listdir(current_dir_path)</span><br><span class="line"></span><br><span class="line">excel_list = [ ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> excel <span class="keyword">in</span> excel_files:</span><br><span class="line">    <span class="keyword">if</span> excel.endswith(<span class="string">&#x27;.xlsx&#x27;</span>):</span><br><span class="line">        excel_list.append(excel)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 根据 目标文件的 目录 读取数据</span></span><br><span class="line">excel_data = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.1 遍历4个excel文件名字 列表</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> excel_list:</span><br><span class="line">    wb = load_workbook(i)</span><br><span class="line">    ws = wb.active</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.2 遍历每个excel文件中的 行</span></span><br><span class="line">    <span class="keyword">for</span> index,row <span class="keyword">in</span> <span class="built_in">enumerate</span>(ws.rows):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果是 表头的数据 不存储</span></span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        data = []</span><br><span class="line">        <span class="comment"># 2.3 遍历 每行里面的单元格  cell</span></span><br><span class="line">        <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">            data.append(cell.value)</span><br><span class="line"></span><br><span class="line">        excel_data.append(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 写入 05mergeexcel.xlsx 文件</span></span><br><span class="line">wb = Workbook()</span><br><span class="line">sheet = wb.active</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> excel_data:</span><br><span class="line">    sheet.append(data)</span><br><span class="line"></span><br><span class="line">wb.save(<span class="string">&#x27;05mergeexcel.xlsx&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>












          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/27/hadoop%E5%9C%A8linux%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lowkeysp"/>
      <meta itemprop="description" content="lowkeysp"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lowkeysp' Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/11/27/hadoop%E5%9C%A8linux%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">hadoop在linux下的安装</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-11-27 09:16:40" itemprop="dateCreated datePublished" datetime="2020-11-27T09:16:40+08:00">2020-11-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-05-11 17:25:03" itemprop="dateModified" datetime="2023-05-11T17:25:03+08:00">2023-05-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2020/11/27/hadoop%E5%9C%A8linux%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85/" class="leancloud_visitors" data-flag-title="hadoop在linux下的安装">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer" />

<p>首先，需要确认Linux系统是否装有JDK，如果没有的话，得先安装JDK</p>
<h1 id="Linux环境下安装JDK"><a href="#Linux环境下安装JDK" class="headerlink" title="Linux环境下安装JDK"></a>Linux环境下安装JDK</h1><ul>
<li><p>从官网上下载Oracle JDK，此次下载的是 jdk-15.0.1_linux-x64_bin.tar.gz </p>
</li>
<li><p>解压：sudo tar -zxvf jdk-15.0.1_linux-aarch64_bin\ 1.tar.gz -C &#x2F;opt&#x2F;modules&#x2F;</p>
<blockquote>
<p>&#x2F;opt 目录简单介绍：Optional application software packages，&#x2F;opt目录用来安装附加软件包，是用户级的程序目录，可以理解为D:&#x2F;Software。安装到&#x2F;opt目录下的程序，它所有的数据、库文件等等都是放在同个目录下面。当你不需要时，直接rm -rf掉即可。</p>
</blockquote>
</li>
<li><p>添加环境变量(此处需要使用root权限，因为&#x2F;etc&#x2F;profile 文件只能root文件写入),在&#x2F;etc&#x2F;profile文件中追加写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=&quot;/opt/modules/jdk-15.0.1&quot;</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>退出文件后，命令 <code>source /etc/profile</code> 使命令生效。</p>
</li>
</ul>
<p>查看是否安装成功，用 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>


<p>之后，就是Hadoop的安装了</p>
<h1 id="Hadoop安装"><a href="#Hadoop安装" class="headerlink" title="Hadoop安装"></a>Hadoop安装</h1><p>下载安装包,此处使用的是清华的镜像</p>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.10.1/">https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.10.1/</a></p>
<h2 id="本地模式"><a href="#本地模式" class="headerlink" title="本地模式"></a>本地模式</h2><p>1、 在&#x2F;opt&#x2F;modules&#x2F;下创建一个hadoopstandalone目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir / opt/modules/hadoopstandalone</span><br></pre></td></tr></table></figure>

<p>2、解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf hadoop-2.10.1.tar.gz -C /opt/modules/hadoopstandalone/</span><br></pre></td></tr></table></figure>


<p>3、 运行mapreduce程序，验证。这是使用hadoop自带的wordcount例子来在本地模式下测试跑mapreduce。自己在&#x2F;opt&#x2F;data&#x2F;下生成一个文件，wc.input，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#cat /opt/data/wc.input</span><br><span class="line">hadoop</span><br><span class="line">mapreduce</span><br><span class="line">hivehbase</span><br><span class="line">spark</span><br><span class="line">stormsqoop</span><br><span class="line">hadoop</span><br><span class="line">hivespark</span><br><span class="line">hadoop</span><br></pre></td></tr></table></figure>

<p>运行hadoop自带的mapreduce Demo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.10.1.jar wordcount /opt/data/wc.input output2</span><br></pre></td></tr></table></figure>

<p>去output2&#x2F;目录下查看，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls</span><br><span class="line">part-r-00000  _SUCCESS</span><br></pre></td></tr></table></figure>
<p>其中,_SUCCESS文件说明JOB运行成功，part-r-00000是输出结果文件</p>
<p>查看part-r-00000</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#cat part-r-00000 </span><br><span class="line">hadoop	3</span><br><span class="line">hivehbase	1</span><br><span class="line">hivespark	1</span><br><span class="line">mapreduce	1</span><br><span class="line">spark	1</span><br><span class="line">stormsqoop	1</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot; aria-label&#x3D;&quot;上一页&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot; aria-label&#x3D;&quot;下一页&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lowkeysp</p>
              <div class="site-description motion-element" itemprop="description">lowkeysp</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%20%7C%7C%20archive">
                
                    <span class="site-state-item-count">85</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/%20%7C%7C%20th">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/%20%7C%7C%20tags">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">69</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lowkeysp</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v6.3.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/affix.js?v=7.1.1"></script>

  <script src="/js/schemes/pisces.js?v=7.1.1"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  



  




  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + '0CSPT60hPj5BKhQ7aSqzw2dl-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': '0CSPT60hPj5BKhQ7aSqzw2dl-gzGzoHsz',
                'X-LC-Key': 'cjQvenU0JlLBfHwEm9f86BEQ',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
